<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>explan_results_viewer &#8212; QuESt Planning 0.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=d1102ebc" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css?v=12dfc556" />
    <script src="../_static/documentation_options.js?v=2709fde1"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for explan_results_viewer</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Updated 3/24 - C.J. Newlun</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">folium</span>
<span class="kn">import</span> <span class="nn">branca.colormap</span> <span class="k">as</span> <span class="nn">cm</span>


<div class="viewcode-block" id="ExplanResultsViewer">
<a class="viewcode-back" href="../index.html#explan_results_viewer.ExplanResultsViewer">[docs]</a>
<span class="k">class</span> <span class="nc">ExplanResultsViewer</span><span class="p">():</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_handler</span><span class="p">,</span> <span class="n">folder_path</span><span class="p">,</span> <span class="n">bus_folder_path</span><span class="p">,</span> <span class="n">cost_folder_path</span><span class="p">,</span> <span class="n">dispatch_folder_path</span><span class="p">,</span> <span class="n">map_folder_path</span><span class="p">,</span> <span class="n">tx_folder_path</span><span class="p">,</span> <span class="n">policy_folder_path</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">,</span> <span class="n">rd</span><span class="p">,</span> <span class="n">pd</span><span class="p">,</span> <span class="n">scenario</span><span class="p">,</span> <span class="n">years</span><span class="p">,</span> <span class="n">start_year</span><span class="p">,</span> <span class="n">end_year</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        </span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data_handler : TYPE</span>
<span class="sd">            DESCRIPTION.</span>
<span class="sd">        folder_path : TYPE</span>
<span class="sd">            DESCRIPTION.</span>
<span class="sd">        bus_folder_path : TYPE</span>
<span class="sd">            DESCRIPTION.</span>
<span class="sd">        cost_folder_path : TYPE</span>
<span class="sd">            DESCRIPTION.</span>
<span class="sd">        dispatch_folder_path : TYPE</span>
<span class="sd">            DESCRIPTION.</span>
<span class="sd">        map_folder_path : TYPE</span>
<span class="sd">            DESCRIPTION.</span>
<span class="sd">        tx_folder_path : TYPE</span>
<span class="sd">            DESCRIPTION.</span>
<span class="sd">        policy_folder_path : TYPE</span>
<span class="sd">            DESCRIPTION.</span>
<span class="sd">        timestamp : TYPE</span>
<span class="sd">            DESCRIPTION.</span>
<span class="sd">        rd : TYPE</span>
<span class="sd">            DESCRIPTION.</span>
<span class="sd">        pd : TYPE</span>
<span class="sd">            DESCRIPTION.</span>
<span class="sd">        scenario : TYPE</span>
<span class="sd">            DESCRIPTION.</span>
<span class="sd">        years : TYPE</span>
<span class="sd">            DESCRIPTION.</span>
<span class="sd">        start_year : TYPE</span>
<span class="sd">            DESCRIPTION.</span>
<span class="sd">        end_year : TYPE</span>
<span class="sd">            DESCRIPTION.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_handler</span> <span class="o">=</span> <span class="n">data_handler</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">folder_path</span> <span class="o">=</span> <span class="n">folder_path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bus_folder_path</span> <span class="o">=</span> <span class="n">bus_folder_path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cost_folder_path</span> <span class="o">=</span> <span class="n">cost_folder_path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dispatch_folder_path</span> <span class="o">=</span> <span class="n">dispatch_folder_path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">map_folder_path</span> <span class="o">=</span> <span class="n">map_folder_path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tx_folder_path</span> <span class="o">=</span> <span class="n">tx_folder_path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">policy_folder_path</span> <span class="o">=</span> <span class="n">policy_folder_path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timestamp</span> <span class="o">=</span> <span class="n">timestamp</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rd</span> <span class="o">=</span> <span class="n">rd</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pd</span> <span class="o">=</span> <span class="n">pd</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scenario</span> <span class="o">=</span> <span class="n">scenario</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">years</span> <span class="o">=</span> <span class="n">years</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_year</span> <span class="o">=</span> <span class="n">start_year</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">end_year</span> <span class="o">=</span> <span class="n">end_year</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">system</span> <span class="o">=</span> <span class="n">data_handler</span><span class="o">.</span><span class="n">scalars</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;System&#39;</span><span class="p">][</span><span class="s1">&#39;Value&#39;</span><span class="p">]</span>

<div class="viewcode-block" id="ExplanResultsViewer.export_results">
<a class="viewcode-back" href="../index.html#explan_results_viewer.ExplanResultsViewer.export_results">[docs]</a>
    <span class="k">def</span> <span class="nf">export_results</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>


<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">folder_path</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">scenario</span><span class="o">+</span><span class="s1">&#39;_&#39;</span> <span class="o">+</span> \
            <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_year</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">end_year</span><span class="p">)</span> <span class="o">+</span> \
            <span class="s1">&#39;_results_&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">timestamp</span><span class="o">+</span><span class="s1">&#39;.xlsx&#39;</span>
        <span class="n">writer</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">ExcelWriter</span><span class="p">(</span>
            <span class="n">filename</span><span class="p">)</span>  <span class="c1"># , engine=&#39;xlsxwriter&#39;)</span>

        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rd</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rd</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>  <span class="c1"># pd.DataFrame()</span>
            <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">empty</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                <span class="n">df</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="n">key</span><span class="p">)</span>
        <span class="n">writer</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="c1"># writer.save()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Pyomo results exported to Excel&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="ExplanResultsViewer.color_tech">
<a class="viewcode-back" href="../index.html#explan_results_viewer.ExplanResultsViewer.color_tech">[docs]</a>
    <span class="k">def</span> <span class="nf">color_tech</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tech</span><span class="p">):</span><span class="c1">#self,</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        TODO: move to txt file(??)</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        tech : TYPE</span>
<span class="sd">            DESCRIPTION.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        TypeError</span>
<span class="sd">            DESCRIPTION.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        color : TYPE</span>
<span class="sd">            DESCRIPTION.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">global</span> <span class="n">color</span>
        <span class="c1">#global fg</span>

        <span class="k">if</span> <span class="n">tech</span> <span class="o">==</span> <span class="s1">&#39;Nuclear&#39;</span><span class="p">:</span>
            <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;darkred&#39;</span>

        <span class="k">elif</span> <span class="n">tech</span> <span class="o">==</span> <span class="s1">&#39;Coal&#39;</span><span class="p">:</span>
            <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span>
        <span class="k">elif</span> <span class="n">tech</span> <span class="o">==</span> <span class="s1">&#39;Oil_CT&#39;</span><span class="p">:</span>
            <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;slategrey&#39;</span>
        <span class="k">elif</span> <span class="n">tech</span> <span class="o">==</span> <span class="s1">&#39;Oil_ST&#39;</span><span class="p">:</span>
            <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;lightslategrey&#39;</span>
        <span class="k">elif</span> <span class="n">tech</span> <span class="o">==</span> <span class="s1">&#39;Hydro&#39;</span><span class="p">:</span>
            <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;steelblue&#39;</span>
        <span class="k">elif</span> <span class="n">tech</span> <span class="o">==</span> <span class="s1">&#39;Gas&#39;</span><span class="p">:</span>
            <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;darkgrey&#39;</span>
        <span class="k">elif</span> <span class="n">tech</span> <span class="o">==</span> <span class="s1">&#39;Gas_CC&#39;</span><span class="p">:</span>
            <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;silver&#39;</span>
        <span class="k">elif</span> <span class="n">tech</span> <span class="o">==</span> <span class="s1">&#39;Gas_CT&#39;</span><span class="p">:</span>
            <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;dimgray&#39;</span>
        <span class="k">elif</span> <span class="n">tech</span> <span class="o">==</span> <span class="s1">&#39;Geothermal&#39;</span><span class="p">:</span>
            <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;rosybrown&#39;</span>
        <span class="k">elif</span> <span class="n">tech</span> <span class="o">==</span> <span class="s1">&#39;Wind PPA&#39;</span><span class="p">:</span>
            <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;darkgreen&#39;</span>
        <span class="k">elif</span> <span class="n">tech</span> <span class="o">==</span> <span class="s1">&#39;Wind&#39;</span><span class="p">:</span>
            <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;darkgreen&#39;</span>
        <span class="k">elif</span> <span class="n">tech</span> <span class="o">==</span> <span class="s1">&#39;Solar&#39;</span><span class="p">:</span>
            <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;yellow&#39;</span>
        <span class="k">elif</span> <span class="n">tech</span> <span class="o">==</span> <span class="s1">&#39;Solar_RT&#39;</span><span class="p">:</span>
            <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;khaki&#39;</span>
        <span class="k">elif</span> <span class="n">tech</span> <span class="o">==</span> <span class="s1">&#39;CSP&#39;</span><span class="p">:</span>
            <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;darkgoldenrod&#39;</span>
        <span class="k">elif</span> <span class="n">tech</span> <span class="o">==</span> <span class="s1">&#39;Solar PPA&#39;</span><span class="p">:</span>
            <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;goldenrod&#39;</span>
        <span class="k">elif</span> <span class="n">tech</span> <span class="o">==</span> <span class="s1">&#39;ES PPA&#39;</span><span class="p">:</span>
            <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;lightsteelblue&#39;</span>
        <span class="k">elif</span> <span class="n">tech</span> <span class="o">==</span> <span class="s1">&#39;ES&#39;</span><span class="p">:</span>
            <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;lightsteelblue&#39;</span>
        <span class="k">elif</span> <span class="n">tech</span> <span class="o">==</span> <span class="s1">&#39;Nat. Gas H2 Conv. (New)&#39;</span><span class="p">:</span>
            <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;lightgrey&#39;</span>
        <span class="k">elif</span> <span class="n">tech</span> <span class="o">==</span> <span class="s1">&#39;Wind (New)&#39;</span><span class="p">:</span>
            <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;lime&#39;</span>
        <span class="k">elif</span> <span class="n">tech</span> <span class="o">==</span> <span class="s1">&#39;Solar (New)&#39;</span><span class="p">:</span>
            <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;gold&#39;</span>
        <span class="k">elif</span> <span class="n">tech</span> <span class="o">==</span> <span class="s1">&#39;ES 4hr (New)&#39;</span><span class="p">:</span>
            <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;royalblue&#39;</span>
        <span class="k">elif</span> <span class="n">tech</span> <span class="o">==</span> <span class="s1">&#39;ES 6hr (New)&#39;</span><span class="p">:</span>
            <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;blue&#39;</span>
        <span class="k">elif</span> <span class="n">tech</span> <span class="o">==</span> <span class="s1">&#39;ES 8hr (New)&#39;</span><span class="p">:</span>
            <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;slateblue&#39;</span>
        <span class="k">elif</span> <span class="n">tech</span> <span class="o">==</span> <span class="s1">&#39;ES 10hr (New)&#39;</span><span class="p">:</span>
            <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;darkviolet&#39;</span>
        <span class="k">elif</span> <span class="n">tech</span> <span class="o">==</span> <span class="s1">&#39;ES 100hr (New)&#39;</span><span class="p">:</span>
            <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;deeppink&#39;</span>
        <span class="k">elif</span> <span class="n">tech</span> <span class="o">==</span> <span class="s1">&#39;Li-Ion Battery (New)&#39;</span> <span class="ow">or</span> <span class="n">tech</span> <span class="o">==</span> <span class="s1">&#39;Li-Ion Battery 1 (New)&#39;</span> <span class="ow">or</span> <span class="n">tech</span> <span class="o">==</span> <span class="s1">&#39;Li-Ion Battery 2 (New)&#39;</span> <span class="ow">or</span> <span class="n">tech</span> <span class="o">==</span> <span class="s1">&#39;Li-Ion Battery 3 (New)&#39;</span> <span class="ow">or</span> <span class="n">tech</span> <span class="o">==</span> <span class="s1">&#39;Li-Ion Battery 4 (New)&#39;</span> <span class="ow">or</span> <span class="n">tech</span> <span class="o">==</span> <span class="s1">&#39;Li-Ion Battery 5 (New)&#39;</span> <span class="ow">or</span> <span class="n">tech</span> <span class="o">==</span> <span class="s1">&#39;Li-Ion Battery 6 (New)&#39;</span> <span class="ow">or</span> <span class="n">tech</span> <span class="o">==</span> <span class="s1">&#39;Li-Ion Battery 7 (New)&#39;</span> <span class="ow">or</span> <span class="n">tech</span> <span class="o">==</span> <span class="s1">&#39;Li-Ion Battery 8 (New)&#39;</span> <span class="ow">or</span> <span class="n">tech</span> <span class="o">==</span> <span class="s1">&#39;Li-Ion Battery 9 (New)&#39;</span> <span class="ow">or</span> <span class="n">tech</span> <span class="o">==</span> <span class="s1">&#39;Li-Ion Battery 10 (New)&#39;</span><span class="p">:</span>
            <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;royalblue&#39;</span>
        <span class="k">elif</span> <span class="n">tech</span> <span class="o">==</span> <span class="s1">&#39;Flow Battery (New)&#39;</span><span class="p">:</span>
            <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;darkviolet&#39;</span>
        <span class="k">elif</span> <span class="n">tech</span> <span class="o">==</span> <span class="s1">&#39;Grav (New)&#39;</span><span class="p">:</span>
            <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;orangered&#39;</span>
        <span class="k">elif</span> <span class="n">tech</span> <span class="o">==</span> <span class="s1">&#39;PSH (New)&#39;</span><span class="p">:</span>
            <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;darkblue&#39;</span>
        <span class="k">elif</span> <span class="n">tech</span> <span class="o">==</span> <span class="s1">&#39;Therm (New)&#39;</span><span class="p">:</span>
            <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;salmon&#39;</span>
        <span class="k">elif</span> <span class="n">tech</span> <span class="o">==</span> <span class="s1">&#39;CAES (New)&#39;</span><span class="p">:</span>
            <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;chocolate&#39;</span>
        <span class="k">elif</span> <span class="n">tech</span> <span class="o">==</span> <span class="s1">&#39;Demand Response (New)&#39;</span><span class="p">:</span>
            <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;cyan&#39;</span>
        <span class="k">elif</span> <span class="n">tech</span> <span class="o">==</span> <span class="s1">&#39;LDES (New)&#39;</span><span class="p">:</span>
            <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;deeppink&#39;</span>
        <span class="k">elif</span> <span class="n">tech</span> <span class="o">==</span> <span class="s1">&#39;Zinc (New)&#39;</span><span class="p">:</span>
            <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;darkturquoise&#39;</span>
        <span class="k">elif</span> <span class="n">tech</span> <span class="o">==</span> <span class="s1">&#39;Hydrogen (New)&#39;</span><span class="p">:</span>
            <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;pink&#39;</span>
        <span class="k">elif</span> <span class="n">tech</span><span class="o">==</span><span class="s1">&#39;Iron Air (New)&#39;</span><span class="p">:</span>
            <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;white&#39;</span>

        <span class="k">elif</span> <span class="n">tech</span> <span class="o">==</span> <span class="s1">&#39;ES PPA-charge&#39;</span><span class="p">:</span>
            <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;lightblue&#39;</span>
        <span class="k">elif</span> <span class="n">tech</span> <span class="o">==</span> <span class="s1">&#39;ES-discharge&#39;</span><span class="p">:</span>
            <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;lightblue&#39;</span>
        <span class="k">elif</span> <span class="n">tech</span> <span class="o">==</span> <span class="s1">&#39;ES 4hr (New)-charge&#39;</span><span class="p">:</span>
            <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;lightskyblue&#39;</span>
        <span class="k">elif</span> <span class="n">tech</span> <span class="o">==</span> <span class="s1">&#39;ES 6hr (New)-charge&#39;</span><span class="p">:</span>
            <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;deepskyblue&#39;</span>
        <span class="k">elif</span> <span class="n">tech</span> <span class="o">==</span> <span class="s1">&#39;ES 8hr (New)-charge&#39;</span><span class="p">:</span>
            <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;steelblue&#39;</span>
        <span class="k">elif</span> <span class="n">tech</span> <span class="o">==</span> <span class="s1">&#39;ES 10hr (New)-charge&#39;</span><span class="p">:</span>
            <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;darkslateblue&#39;</span>
        <span class="k">elif</span> <span class="n">tech</span> <span class="o">==</span> <span class="s1">&#39;ES 100hr (New)-charge&#39;</span><span class="p">:</span>
            <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;darkblue&#39;</span>
        <span class="k">elif</span> <span class="n">tech</span> <span class="o">==</span> <span class="s1">&#39;Li-Ion Battery (New)-charge&#39;</span> <span class="ow">or</span> <span class="n">tech</span> <span class="o">==</span> <span class="s1">&#39;Li-Ion Battery 1 (New)-charge&#39;</span> <span class="ow">or</span> <span class="n">tech</span> <span class="o">==</span> <span class="s1">&#39;Li-Ion Battery 2 (New)-charge&#39;</span> <span class="ow">or</span> <span class="n">tech</span> <span class="o">==</span> <span class="s1">&#39;Li-Ion Battery 3 (New)-charge&#39;</span> <span class="ow">or</span> <span class="n">tech</span> <span class="o">==</span> <span class="s1">&#39;Li-Ion Battery 4 (New)-charge&#39;</span> <span class="ow">or</span> <span class="n">tech</span> <span class="o">==</span> <span class="s1">&#39;Li-Ion Battery 5 (New)-charge&#39;</span> <span class="ow">or</span> <span class="n">tech</span> <span class="o">==</span> <span class="s1">&#39;Li-Ion Battery 6 (New)-charge&#39;</span> <span class="ow">or</span> <span class="n">tech</span> <span class="o">==</span> <span class="s1">&#39;Li-Ion Battery 7 (New)-charge&#39;</span> <span class="ow">or</span> <span class="n">tech</span> <span class="o">==</span> <span class="s1">&#39;Li-Ion Battery 8 (New)-charge&#39;</span> <span class="ow">or</span> <span class="n">tech</span> <span class="o">==</span> <span class="s1">&#39;Li-Ion Battery 9 (New)-charge&#39;</span> <span class="ow">or</span> <span class="n">tech</span> <span class="o">==</span> <span class="s1">&#39;Li-Ion Battery 10 (New)-charge&#39;</span><span class="p">:</span>
            <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;royalblue&#39;</span>
        <span class="k">elif</span> <span class="n">tech</span> <span class="o">==</span> <span class="s1">&#39;Flow Battery (New)-charge&#39;</span><span class="p">:</span>
            <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;darkviolet&#39;</span>
        <span class="k">elif</span> <span class="n">tech</span> <span class="o">==</span> <span class="s1">&#39;Grav (New)-charge&#39;</span><span class="p">:</span>
            <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;orangered&#39;</span>
        <span class="k">elif</span> <span class="n">tech</span> <span class="o">==</span> <span class="s1">&#39;PSH (New)-charge&#39;</span><span class="p">:</span>
            <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;darkblue&#39;</span>
        <span class="k">elif</span> <span class="n">tech</span> <span class="o">==</span> <span class="s1">&#39;Therm (New)-charge&#39;</span><span class="p">:</span>
            <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;salmon&#39;</span>
        <span class="k">elif</span> <span class="n">tech</span> <span class="o">==</span> <span class="s1">&#39;CAES (New)-charge&#39;</span><span class="p">:</span>
            <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;chocolate&#39;</span>
        <span class="k">elif</span> <span class="n">tech</span> <span class="o">==</span> <span class="s1">&#39;LDES (New)&#39;</span><span class="p">:</span>
            <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;darkblue&#39;</span>
        <span class="k">elif</span> <span class="n">tech</span> <span class="o">==</span> <span class="s1">&#39;Zinc (New)-charge&#39;</span><span class="p">:</span>
            <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;darkturquoise&#39;</span>
        <span class="k">elif</span> <span class="n">tech</span> <span class="o">==</span> <span class="s1">&#39;Hydrogen (New)-charge&#39;</span><span class="p">:</span>
            <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;pink&#39;</span>

        <span class="k">elif</span> <span class="n">tech</span> <span class="o">==</span> <span class="s1">&#39;ES PPA-discharge&#39;</span><span class="p">:</span>
            <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;lightpink&#39;</span>
        <span class="k">elif</span> <span class="n">tech</span> <span class="o">==</span> <span class="s1">&#39;ES-charge&#39;</span><span class="p">:</span>
            <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;lightpink&#39;</span>
        <span class="k">elif</span> <span class="n">tech</span> <span class="o">==</span> <span class="s1">&#39;ES 4hr (New)-discharge&#39;</span><span class="p">:</span>
            <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;hotpink&#39;</span>
        <span class="k">elif</span> <span class="n">tech</span> <span class="o">==</span> <span class="s1">&#39;ES 6hr (New)-discharge&#39;</span><span class="p">:</span>
            <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;deeppink&#39;</span>
        <span class="k">elif</span> <span class="n">tech</span> <span class="o">==</span> <span class="s1">&#39;ES 8hr (New)-discharge&#39;</span><span class="p">:</span>
            <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;mediumvioletred&#39;</span>
        <span class="k">elif</span> <span class="n">tech</span> <span class="o">==</span> <span class="s1">&#39;ES 10hr (New)-discharge&#39;</span><span class="p">:</span>
            <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;mediumorchid&#39;</span>
        <span class="k">elif</span> <span class="n">tech</span> <span class="o">==</span> <span class="s1">&#39;ES 100hr (New)-discharge&#39;</span><span class="p">:</span>
            <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;purple&#39;</span>
        <span class="k">elif</span> <span class="n">tech</span> <span class="o">==</span> <span class="s1">&#39;Li-Ion Battery (New)-discharge&#39;</span> <span class="ow">or</span> <span class="n">tech</span> <span class="o">==</span> <span class="s1">&#39;Li-Ion Battery 1 (New)-discharge&#39;</span> <span class="ow">or</span> <span class="n">tech</span> <span class="o">==</span> <span class="s1">&#39;Li-Ion Battery 2 (New)-discharge&#39;</span> <span class="ow">or</span> <span class="n">tech</span> <span class="o">==</span> <span class="s1">&#39;Li-Ion Battery 3 (New)-discharge&#39;</span> <span class="ow">or</span> <span class="n">tech</span> <span class="o">==</span> <span class="s1">&#39;Li-Ion Battery 4 (New)-discharge&#39;</span> <span class="ow">or</span> <span class="n">tech</span> <span class="o">==</span> <span class="s1">&#39;Li-Ion Battery 5 (New)-discharge&#39;</span> <span class="ow">or</span> <span class="n">tech</span> <span class="o">==</span> <span class="s1">&#39;Li-Ion Battery 6 (New)-discharge&#39;</span> <span class="ow">or</span> <span class="n">tech</span> <span class="o">==</span> <span class="s1">&#39;Li-Ion Battery 7 (New)-discharge&#39;</span> <span class="ow">or</span> <span class="n">tech</span> <span class="o">==</span> <span class="s1">&#39;Li-Ion Battery 8 (New)-discharge&#39;</span> <span class="ow">or</span> <span class="n">tech</span> <span class="o">==</span> <span class="s1">&#39;Li-Ion Battery 9 (New)-discharge&#39;</span> <span class="ow">or</span> <span class="n">tech</span> <span class="o">==</span> <span class="s1">&#39;Li-Ion Battery 10 (New)-discharge&#39;</span><span class="p">:</span>
            <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;hotpink&#39;</span>
        <span class="k">elif</span> <span class="n">tech</span> <span class="o">==</span> <span class="s1">&#39;Flow Battery (New)-discharge&#39;</span><span class="p">:</span>
            <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;mediumorchid&#39;</span>
        <span class="k">elif</span> <span class="n">tech</span> <span class="o">==</span> <span class="s1">&#39;Grav (New)-discharge&#39;</span><span class="p">:</span>
            <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;lightsalmon&#39;</span>
        <span class="k">elif</span> <span class="n">tech</span> <span class="o">==</span> <span class="s1">&#39;PSH (New)-discharge&#39;</span><span class="p">:</span>
            <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;lightblue&#39;</span>
        <span class="k">elif</span> <span class="n">tech</span> <span class="o">==</span> <span class="s1">&#39;Therm (New)-discharge&#39;</span><span class="p">:</span>
            <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;salmon&#39;</span>
        <span class="k">elif</span> <span class="n">tech</span> <span class="o">==</span> <span class="s1">&#39;CAES (New)-discharge&#39;</span><span class="p">:</span>
            <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;sandybrown&#39;</span>
        <span class="k">elif</span> <span class="n">tech</span> <span class="o">==</span> <span class="s1">&#39;LDES (New)&#39;</span><span class="p">:</span>
            <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;purple&#39;</span>
        <span class="k">elif</span> <span class="n">tech</span> <span class="o">==</span> <span class="s1">&#39;Zinc (New)-discharge&#39;</span><span class="p">:</span>
            <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;aquamarine&#39;</span>
        <span class="k">elif</span> <span class="n">tech</span> <span class="o">==</span> <span class="s1">&#39;Hydrogen (New)-discharge&#39;</span><span class="p">:</span>
            <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;plum&#39;</span>

        <span class="k">elif</span> <span class="n">tech</span> <span class="o">==</span> <span class="s1">&#39;Curtailment&#39;</span><span class="p">:</span>
            <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;moccasin&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">tech</span><span class="o">+</span><span class="s2">&quot; is not valid&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">color</span></div>


<div class="viewcode-block" id="ExplanResultsViewer.stacked_resource_bar">
<a class="viewcode-back" href="../index.html#explan_results_viewer.ExplanResultsViewer.stacked_resource_bar">[docs]</a>
    <span class="k">def</span> <span class="nf">stacked_resource_bar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gen_map_info</span><span class="p">,</span> <span class="n">tech_map_info</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>


<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        gen_map_info : TYPE</span>
<span class="sd">            DESCRIPTION.</span>
<span class="sd">        tech_map_info : TYPE</span>
<span class="sd">            DESCRIPTION.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rd</span><span class="p">[</span><span class="s1">&#39;P_cap_total&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">names</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">results</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># results.reset_index(inplace=True)</span>
        <span class="c1"># add tech name</span>
        <span class="n">translate</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">x</span><span class="p">:</span> <span class="n">y</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">gen_map_info</span><span class="p">[[</span><span class="s1">&#39;Gen_num&#39;</span><span class="p">,</span> <span class="s1">&#39;Tech_Num&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span><span class="p">}</span>
        <span class="n">tech_num</span> <span class="o">=</span> <span class="p">[</span><span class="n">translate</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;g&#39;</span><span class="p">]]</span>
        <span class="n">results</span><span class="p">[</span><span class="s1">&#39;Technology&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tech_num</span>

        <span class="c1">#all_tech = np.unique(gen_map_info[&#39;Tech_ID&#39;])</span>
        <span class="c1"># need to reorder for stack plots</span>

        <span class="c1">#nums = np.arange(1,np.size(re_order_tech)+1)</span>
        <span class="c1"># num_tech =</span>

        <span class="n">results_pivot</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;Value&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span>
            <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">],</span> <span class="n">columns</span><span class="o">=</span><span class="s1">&#39;Technology&#39;</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="s1">&#39;Value&#39;</span><span class="p">,</span> <span class="n">aggfunc</span><span class="o">=</span><span class="s1">&#39;sum&#39;</span><span class="p">)</span>

        <span class="c1"># rename columns</span>
        <span class="n">translate1</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">x</span><span class="p">:</span> <span class="n">y</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">tech_map_info</span><span class="p">[[</span><span class="s1">&#39;Tech_Num&#39;</span><span class="p">,</span> <span class="s1">&#39;Tech_Name&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span><span class="p">}</span>
        <span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">translate1</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">results_pivot</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>

        <span class="n">results_pivot</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">cols</span>
        <span class="c1"># assign colors</span>
        <span class="n">color_array</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">color_tech</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">cols</span><span class="p">]</span>

        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">results_pivot</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">stacked</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color_array</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span>
            <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span> <span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.75</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;center left&quot;</span><span class="p">,</span>
                  <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Capacity (MW)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Years&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Installed capacity&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">25</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">margins</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">folder_path</span><span class="o">+</span><span class="s1">&#39;/&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">scenario</span> <span class="o">+</span>
                    <span class="s1">&#39;_stacked_bar.png&#39;</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span></div>

        <span class="c1"># save legend as png for input into folium</span>

<div class="viewcode-block" id="ExplanResultsViewer.stacked_resource_area">
<a class="viewcode-back" href="../index.html#explan_results_viewer.ExplanResultsViewer.stacked_resource_area">[docs]</a>
    <span class="k">def</span> <span class="nf">stacked_resource_area</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gen_map_info</span><span class="p">,</span> <span class="n">tech_map_info</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        gen_map_info : TYPE</span>
<span class="sd">            DESCRIPTION.</span>
<span class="sd">        tech_map_info : TYPE</span>
<span class="sd">            DESCRIPTION.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rd</span><span class="p">[</span><span class="s1">&#39;P_cap_total&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">names</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">results</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># results.reset_index(inplace=True)</span>
        <span class="c1"># add tech name</span>
        <span class="n">translate</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">x</span><span class="p">:</span> <span class="n">y</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">gen_map_info</span><span class="p">[[</span><span class="s1">&#39;Gen_num&#39;</span><span class="p">,</span> <span class="s1">&#39;Tech_Num&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span><span class="p">}</span>
        <span class="n">tech_num</span> <span class="o">=</span> <span class="p">[</span><span class="n">translate</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;g&#39;</span><span class="p">]]</span>
        <span class="n">results</span><span class="p">[</span><span class="s1">&#39;Technology&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tech_num</span>

        <span class="c1">#all_tech = np.unique(gen_map_info[&#39;Tech_ID&#39;])</span>
        <span class="c1"># need to reorder for stack plots</span>

        <span class="c1">#nums = np.arange(1,np.size(re_order_tech)+1)</span>
        <span class="c1"># num_tech =</span>

        <span class="n">results_pivot</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;Value&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span>
            <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">],</span> <span class="n">columns</span><span class="o">=</span><span class="s1">&#39;Technology&#39;</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="s1">&#39;Value&#39;</span><span class="p">,</span> <span class="n">aggfunc</span><span class="o">=</span><span class="s1">&#39;sum&#39;</span><span class="p">)</span>

        <span class="n">results_pivot</span> <span class="o">=</span> <span class="n">results_pivot</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="c1"># rename columns</span>
        <span class="n">translate1</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">x</span><span class="p">:</span> <span class="n">y</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">tech_map_info</span><span class="p">[[</span><span class="s1">&#39;Tech_Num&#39;</span><span class="p">,</span> <span class="s1">&#39;Tech_Name&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span><span class="p">}</span>
        <span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">translate1</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">results_pivot</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>

        <span class="n">results_pivot</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">cols</span>
        <span class="c1"># assign colors</span>
        <span class="n">color_array</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">color_tech</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">cols</span><span class="p">]</span>

        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">results_pivot</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">area</span><span class="p">(</span><span class="n">stacked</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color_array</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span>
            <span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">],</span> <span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span><span class="o">.</span><span class="n">figure</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;center left&quot;</span><span class="p">,</span>
                  <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
       
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Capacity (MW)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Years&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Installed capacity&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">25</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">margins</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">folder_path</span><span class="o">+</span><span class="s1">&#39;/&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">scenario</span> <span class="o">+</span>
                    <span class="s1">&#39;_stacked_area.png&#39;</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="ExplanResultsViewer.stacked_resource_bar_by_bus">
<a class="viewcode-back" href="../index.html#explan_results_viewer.ExplanResultsViewer.stacked_resource_bar_by_bus">[docs]</a>
    <span class="k">def</span> <span class="nf">stacked_resource_bar_by_bus</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gen_map_info</span><span class="p">,</span> <span class="n">tech_map_info</span><span class="p">,</span> <span class="n">bus</span><span class="p">,</span> <span class="n">bus_names</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>


<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        gen_map_info : TYPE</span>
<span class="sd">            DESCRIPTION.</span>
<span class="sd">        tech_map_info : TYPE</span>
<span class="sd">            DESCRIPTION.</span>
<span class="sd">        bus : TYPE</span>
<span class="sd">            DESCRIPTION.</span>
<span class="sd">        bus_names : TYPE</span>
<span class="sd">            DESCRIPTION.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rd</span><span class="p">[</span><span class="s1">&#39;P_cap_total&#39;</span><span class="p">]</span>
        <span class="n">results</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># add tech name</span>
        <span class="n">translate</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">x</span><span class="p">:</span> <span class="n">y</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">gen_map_info</span><span class="p">[[</span><span class="s1">&#39;Gen_num&#39;</span><span class="p">,</span> <span class="s1">&#39;Tech_Num&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span><span class="p">}</span>
        <span class="n">tech_num</span> <span class="o">=</span> <span class="p">[</span><span class="n">translate</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;g&#39;</span><span class="p">]]</span>
        <span class="n">results</span><span class="p">[</span><span class="s1">&#39;Technology&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tech_num</span>

        <span class="c1">#all_tech = np.unique(gen_map_info[&#39;Tech_ID&#39;])</span>
        <span class="c1"># need to reorder for stack plots</span>

        <span class="c1">#nums = np.arange(1,np.size(re_order_tech)+1)</span>
        <span class="c1"># num_tech =</span>

        <span class="c1">#bus_nums = np.unique(results[&#39;b&#39;])</span>
        <span class="c1">#fig, axs = plt.subplots(int(np.size(bus_nums)/2)+1,int(np.size(bus_nums)/2))</span>
        <span class="c1"># for b in bus_nums:</span>
        <span class="n">results_b</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">bus</span><span class="p">]</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">bus_names</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">bus_names</span><span class="p">[</span><span class="s1">&#39;Bus_number&#39;</span><span class="p">]</span>
                             <span class="o">==</span> <span class="n">bus</span><span class="p">][</span><span class="s1">&#39;Bus_name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c1"># np.size(results_b) != 0:</span>
        <span class="n">results_pivot</span> <span class="o">=</span> <span class="n">results_b</span><span class="p">[</span><span class="n">results_b</span><span class="p">[</span><span class="s1">&#39;Value&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span>
            <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">],</span> <span class="n">columns</span><span class="o">=</span><span class="s1">&#39;Technology&#39;</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="s1">&#39;Value&#39;</span><span class="p">,</span> <span class="n">aggfunc</span><span class="o">=</span><span class="s1">&#39;sum&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">results_pivot</span><span class="o">.</span><span class="n">empty</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="c1"># rename columns</span>
            <span class="n">translate1</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">x</span><span class="p">:</span> <span class="n">y</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">tech_map_info</span><span class="p">[[</span><span class="s1">&#39;Tech_Num&#39;</span><span class="p">,</span> <span class="s1">&#39;Tech_Name&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span><span class="p">}</span>
            <span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">translate1</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">results_pivot</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>

            <span class="n">results_pivot</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">cols</span>
            <span class="c1"># assign colors</span>
            <span class="n">color_array</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">color_tech</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">cols</span><span class="p">]</span>

            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">results_pivot</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">stacked</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color_array</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span>
                <span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">],</span> <span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;center left&quot;</span><span class="p">,</span>
                      <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Capacity (MW)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">25</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Years&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">25</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span>
                <span class="s1">&#39;Installed capacity: Zone &#39;</span><span class="o">+</span><span class="n">name</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">margins</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bus_folder_path</span><span class="o">+</span><span class="s1">&#39;/&#39;</span><span class="o">+</span><span class="s1">&#39;_stacked_bar_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                        <span class="o">+</span> <span class="s1">&#39;.png&#39;</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
            <span class="c1"># return fig</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">])</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span>
                <span class="s1">&#39;Installed capacity: Zone &#39;</span><span class="o">+</span><span class="n">name</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bus_folder_path</span><span class="o">+</span><span class="s1">&#39;/&#39;</span><span class="o">+</span><span class="s1">&#39;_stacked_bar_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                        <span class="o">+</span> <span class="s1">&#39;.png&#39;</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="ExplanResultsViewer.stacked_resource_area_by_bus">
<a class="viewcode-back" href="../index.html#explan_results_viewer.ExplanResultsViewer.stacked_resource_area_by_bus">[docs]</a>
    <span class="k">def</span> <span class="nf">stacked_resource_area_by_bus</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gen_map_info</span><span class="p">,</span> <span class="n">tech_map_info</span><span class="p">,</span> <span class="n">bus</span><span class="p">,</span> <span class="n">bus_names</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>


<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        gen_map_info : TYPE</span>
<span class="sd">            DESCRIPTION.</span>
<span class="sd">        tech_map_info : TYPE</span>
<span class="sd">            DESCRIPTION.</span>
<span class="sd">        bus : TYPE</span>
<span class="sd">            DESCRIPTION.</span>
<span class="sd">        bus_names : TYPE</span>
<span class="sd">            DESCRIPTION.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rd</span><span class="p">[</span><span class="s1">&#39;P_cap_total&#39;</span><span class="p">]</span>
        <span class="n">results</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># add tech name</span>
        <span class="n">translate</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">x</span><span class="p">:</span> <span class="n">y</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">gen_map_info</span><span class="p">[[</span><span class="s1">&#39;Gen_num&#39;</span><span class="p">,</span> <span class="s1">&#39;Tech_Num&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span><span class="p">}</span>
        <span class="n">tech_num</span> <span class="o">=</span> <span class="p">[</span><span class="n">translate</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;g&#39;</span><span class="p">]]</span>
        <span class="n">results</span><span class="p">[</span><span class="s1">&#39;Technology&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tech_num</span>

        <span class="c1">#all_tech = np.unique(gen_map_info[&#39;Tech_ID&#39;])</span>
        <span class="c1"># need to reorder for stack plots</span>

        <span class="c1">#nums = np.arange(1,np.size(re_order_tech)+1)</span>
        <span class="c1"># num_tech =</span>

        <span class="c1">#bus_nums = np.unique(results[&#39;b&#39;])</span>
        <span class="c1">#fig, axs = plt.subplots(int(np.size(bus_nums)/2)+1,int(np.size(bus_nums)/2))</span>
        <span class="c1"># for b in bus_nums:</span>
        <span class="n">results_b</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">bus</span><span class="p">]</span>

        <span class="n">results_pivot</span> <span class="o">=</span> <span class="n">results_b</span><span class="p">[</span><span class="n">results_b</span><span class="p">[</span><span class="s1">&#39;Value&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span>
            <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">],</span> <span class="n">columns</span><span class="o">=</span><span class="s1">&#39;Technology&#39;</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="s1">&#39;Value&#39;</span><span class="p">,</span> <span class="n">aggfunc</span><span class="o">=</span><span class="s1">&#39;sum&#39;</span><span class="p">)</span>
        <span class="n">results_pivot</span> <span class="o">=</span> <span class="n">results_pivot</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="n">name</span> <span class="o">=</span> <span class="n">bus_names</span><span class="p">[</span><span class="n">bus_names</span><span class="p">[</span><span class="s1">&#39;Bus_number&#39;</span><span class="p">]</span>
                         <span class="o">==</span> <span class="n">bus</span><span class="p">][</span><span class="s1">&#39;Bus_name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">results_pivot</span><span class="o">.</span><span class="n">empty</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="c1"># rename columns</span>
            <span class="n">translate1</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">x</span><span class="p">:</span> <span class="n">y</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">tech_map_info</span><span class="p">[[</span><span class="s1">&#39;Tech_Num&#39;</span><span class="p">,</span> <span class="s1">&#39;Tech_Name&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span><span class="p">}</span>
            <span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">translate1</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">results_pivot</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>

            <span class="n">results_pivot</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">cols</span>
            <span class="c1"># assign colors</span>
            <span class="n">color_array</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">color_tech</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">cols</span><span class="p">]</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">results_pivot</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">area</span><span class="p">(</span><span class="n">stacked</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color_array</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span>
                <span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">],</span> <span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span><span class="o">.</span><span class="n">figure</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;center left&quot;</span><span class="p">,</span>
                      <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Capacity (MW)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">25</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Years&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">25</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span>
                <span class="s1">&#39;Installed capacity: &#39;</span><span class="o">+</span><span class="n">name</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">margins</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bus_folder_path</span><span class="o">+</span><span class="s1">&#39;/&#39;</span><span class="o">+</span><span class="s1">&#39;_stacked_area_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                        <span class="o">+</span> <span class="s1">&#39;.png&#39;</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>

            <span class="c1"># return fig</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">])</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span>
                <span class="s1">&#39;Installed capacity: Zone &#39;</span><span class="o">+</span><span class="n">name</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bus_folder_path</span><span class="o">+</span><span class="s1">&#39;/&#39;</span><span class="o">+</span><span class="s1">&#39;_stacked_bar_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                        <span class="o">+</span> <span class="s1">&#39;.png&#39;</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="ExplanResultsViewer.plot_cost_bar">
<a class="viewcode-back" href="../index.html#explan_results_viewer.ExplanResultsViewer.plot_cost_bar">[docs]</a>
    <span class="k">def</span> <span class="nf">plot_cost_bar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>


<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># gather cost data</span>
        <span class="n">all_costs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
        <span class="n">all_costs</span><span class="p">[</span><span class="s1">&#39;FOM&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rd</span><span class="p">[</span><span class="s1">&#39;annual_fom_cost&#39;</span><span class="p">]</span>
        <span class="n">all_costs</span><span class="p">[</span><span class="s1">&#39;VOM&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rd</span><span class="p">[</span><span class="s1">&#39;annual_vom_cost&#39;</span><span class="p">]</span>
        <span class="n">all_costs</span><span class="p">[</span><span class="s1">&#39;Fuel&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rd</span><span class="p">[</span><span class="s1">&#39;annual_fuel_cost&#39;</span><span class="p">]</span>
        <span class="n">all_costs</span><span class="p">[</span><span class="s1">&#39;Penalty&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rd</span><span class="p">[</span><span class="s1">&#39;annual_ls_cost&#39;</span><span class="p">]</span>
        <span class="n">all_inv_costs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
        <span class="n">all_inv_costs</span><span class="p">[</span><span class="s1">&#39;Generation Investment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rd</span><span class="p">[</span><span class="s1">&#39;annual_gen_inv_cost&#39;</span><span class="p">]</span>
        <span class="n">all_inv_costs</span><span class="p">[</span><span class="s1">&#39;Transmission Investment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rd</span><span class="p">[</span><span class="s1">&#39;annual_trans_inv_cost&#39;</span><span class="p">]</span>
        <span class="n">all_inv_costs</span><span class="p">[</span><span class="s1">&#39;ES Replacement Cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rd</span><span class="p">[</span><span class="s1">&#39;annual_es_replace_cost&#39;</span><span class="p">]</span>

        <span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="s1">&#39;mediumblue&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;saddlebrown&#39;</span><span class="p">,</span> <span class="s1">&#39;red&#39;</span><span class="p">]</span>
        <span class="n">colors_inv</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="s1">&#39;orange&#39;</span><span class="p">,</span> <span class="s1">&#39;salmon&#39;</span><span class="p">]</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>
        <span class="n">all_costs</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span>
            <span class="n">stacked</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Annual Operational Costs&#39;</span><span class="p">)</span>
        <span class="n">all_inv_costs</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span>
            <span class="n">stacked</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colors_inv</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Annual Investment Costs&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cost_folder_path</span> <span class="o">+</span>
                    <span class="s1">&#39;/&#39;</span><span class="o">+</span><span class="s1">&#39;Total_Costs.png&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="ExplanResultsViewer.plot_tx_flow">
<a class="viewcode-back" href="../index.html#explan_results_viewer.ExplanResultsViewer.plot_tx_flow">[docs]</a>
    <span class="k">def</span> <span class="nf">plot_tx_flow</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>


<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rd</span><span class="p">[</span><span class="s1">&#39;PF&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">pf</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">names</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">pf</span> <span class="o">=</span> <span class="n">pf</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">years</span><span class="p">:</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span>
                <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">pf</span><span class="p">[</span><span class="s1">&#39;s&#39;</span><span class="p">])),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">12</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_handler</span><span class="o">.</span><span class="n">block_selection</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;Peak_Day&#39;</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                <span class="n">pf_y_s</span> <span class="o">=</span> <span class="n">pf</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">pf</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">y</span><span class="p">)]</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span>
                    <span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s1">&#39;l&#39;</span><span class="p">])</span>
                <span class="n">pf_y_s</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                    <span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Power Flow&#39;</span><span class="p">)</span>
                <span class="n">axs</span><span class="o">.</span><span class="n">margins</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">pf</span><span class="p">[</span><span class="s1">&#39;s&#39;</span><span class="p">]):</span>
                    <span class="n">pf_y_s</span> <span class="o">=</span> <span class="n">pf</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">pf</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">y</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">pf</span><span class="p">[</span><span class="s1">&#39;s&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">s</span><span class="p">)]</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span>
                        <span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s1">&#39;l&#39;</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">s</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">season</span> <span class="o">=</span> <span class="s1">&#39;Winter&#39;</span>
                    <span class="k">elif</span> <span class="n">s</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="n">season</span> <span class="o">=</span> <span class="s1">&#39;Spring&#39;</span>
                    <span class="k">elif</span> <span class="n">s</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                        <span class="n">season</span> <span class="o">=</span> <span class="s1">&#39;Summer&#39;</span>
                    <span class="k">elif</span> <span class="n">s</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                        <span class="n">season</span> <span class="o">=</span> <span class="s1">&#39;Fall&#39;</span>
                    <span class="k">elif</span> <span class="n">s</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
                        <span class="n">season</span> <span class="o">=</span> <span class="s1">&#39;Peak Week&#39;</span>
                    <span class="n">ax</span> <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="n">s</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">pf_y_s</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                        <span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">season</span><span class="p">)</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">margins</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span>
                <span class="s1">&#39;Transmission Flow (&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">supxlabel</span><span class="p">(</span><span class="s1">&#39;Time (h)&#39;</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">supylabel</span><span class="p">(</span><span class="s1">&#39;Power Flow (MW)&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tx_folder_path</span> <span class="o">+</span>
                        <span class="s1">&#39;/&#39;</span><span class="o">+</span><span class="s1">&#39;Tx_Flow_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;.png&#39;</span><span class="p">)</span></div>


    <span class="k">def</span> <span class="nf">plot_es_system</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gen_map_info</span><span class="p">,</span> <span class="n">tech_map_info</span><span class="p">):</span>

        <span class="c1">#bus_list = exp.data_handler.load_data[&#39;BUS&#39;][&#39;Bus_number&#39;].values</span>
        <span class="c1"># bus_names = exp.data_handler.load_data[&#39;BUS&#39;][[</span>
        <span class="c1">#  &#39;Bus_number&#39;, &#39;Bus_name&#39;]]</span>

        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rd</span><span class="p">[</span><span class="s1">&#39;P_cap_total&#39;</span><span class="p">]</span>
        <span class="n">results_en1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rd</span><span class="p">[</span><span class="s1">&#39;Store&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">names</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">results</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="c1">#drop=True, inplace=True</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">results_en1</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">names</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">results_en1</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="c1">#drop=True,inplace=True</span>
        <span class="c1">#if np.size(results_en.index.names) &gt; 1:</span>
        <span class="c1">#results_en.reset_index()#drop=True, inplace=True)</span>
        <span class="c1"># add tech name</span>
        <span class="n">translate</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">x</span><span class="p">:</span> <span class="n">y</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">gen_map_info</span><span class="p">[[</span><span class="s1">&#39;Gen_num&#39;</span><span class="p">,</span> <span class="s1">&#39;Tech_Num&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span><span class="p">}</span>
        <span class="n">tech_num</span> <span class="o">=</span> <span class="p">[</span><span class="n">translate</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;g&#39;</span><span class="p">]]</span>
        <span class="n">results</span><span class="p">[</span><span class="s1">&#39;Technology&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tech_num</span>
        <span class="n">tech_num</span> <span class="o">=</span> <span class="p">[</span><span class="n">translate</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">results_en1</span><span class="p">[</span><span class="s1">&#39;g&#39;</span><span class="p">]]</span>
        <span class="n">results_en1</span><span class="p">[</span><span class="s1">&#39;Technology&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tech_num</span>

        <span class="c1"># filter for ES tech</span>
        <span class="n">results</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;Technology&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data_handler</span><span class="o">.</span><span class="n">load_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">data_handler</span><span class="o">.</span><span class="n">data_ls</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;storage&#39;</span><span class="p">)][</span><span class="s1">&#39;Tech_Num&#39;</span><span class="p">]))]</span>
        <span class="n">results</span><span class="p">[</span><span class="s1">&#39;Energy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">results_en1</span><span class="p">[</span><span class="s1">&#39;Value&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="n">results</span><span class="p">[</span><span class="s1">&#39;Duration&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;Energy&#39;</span><span class="p">]</span> <span class="o">/</span> \
            <span class="n">results</span><span class="p">[</span><span class="s1">&#39;Value&#39;</span><span class="p">]</span>

        <span class="n">results_pivot</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span>
            <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">],</span> <span class="n">columns</span><span class="o">=</span><span class="s1">&#39;Technology&#39;</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="s1">&#39;Value&#39;</span><span class="p">,</span> <span class="n">aggfunc</span><span class="o">=</span><span class="s1">&#39;sum&#39;</span><span class="p">)</span>
        <span class="n">results_pivot</span> <span class="o">=</span> <span class="n">results_pivot</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">translate1</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">x</span><span class="p">:</span> <span class="n">y</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">tech_map_info</span><span class="p">[[</span><span class="s1">&#39;Tech_Num&#39;</span><span class="p">,</span> <span class="s1">&#39;Tech_Name&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span><span class="p">}</span>
        <span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">translate1</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">results_pivot</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
        <span class="n">results_pivot</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">cols</span>
        <span class="c1"># filter out very small values - solver error</span>
        <span class="n">results_pivot</span><span class="p">[</span><span class="n">results_pivot</span> <span class="o">&lt;</span> <span class="mf">0.001</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># delete zero columns</span>
        <span class="n">results_pivot</span> <span class="o">=</span> <span class="n">results_pivot</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="p">(</span><span class="n">results_pivot</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">(</span>
            <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)]</span>

        <span class="c1"># fig, ax = plt.subplots(1, 1, figsize=[</span>
        <span class="c1"># 10, 8])</span>
        <span class="c1">#ax2 = ax.twinx()</span>
        <span class="n">color_array</span> <span class="o">=</span> <span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">color_tech</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">results_pivot</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
        <span class="c1">#print(cols)</span>
        <span class="c1">#print(color_array)</span>
        <span class="c1"># results_pivot.plot.bar(</span>
        <span class="c1">#   stacked=True, color=color_array, legend=False, linewidth=3, ax=ax).figure</span>

        <span class="n">results_en_pivot</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span>
            <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">],</span> <span class="n">columns</span><span class="o">=</span><span class="s1">&#39;Technology&#39;</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="s1">&#39;Energy&#39;</span><span class="p">,</span> <span class="n">aggfunc</span><span class="o">=</span><span class="s1">&#39;sum&#39;</span><span class="p">)</span>
        <span class="n">results_en_pivot</span> <span class="o">=</span> <span class="n">results_en_pivot</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">translate1</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">x</span><span class="p">:</span> <span class="n">y</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">tech_map_info</span><span class="p">[[</span><span class="s1">&#39;Tech_Num&#39;</span><span class="p">,</span> <span class="s1">&#39;Tech_Name&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span><span class="p">}</span>
        <span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">translate1</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">results_en_pivot</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
        <span class="n">results_en_pivot</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">cols</span>
        <span class="c1"># filter out very small values - solver error</span>
        <span class="n">results_en_pivot</span><span class="p">[</span><span class="n">results_en_pivot</span> <span class="o">&lt;</span> <span class="mf">0.001</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># delete zero columns</span>
        <span class="n">results_en_pivot</span> <span class="o">=</span> <span class="n">results_en_pivot</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="p">(</span><span class="n">results_en_pivot</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">(</span>
            <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)]</span>
        <span class="c1"># color_array = [</span>
        <span class="c1">#  self.color_tech(c) for c in cols]</span>

        <span class="c1">#results_pivot[&#39;Energy&#39;] = results_en_pivot.values</span>
        <span class="c1"># ax2.plot(results_pivot.index,</span>
        <span class="c1">#       results_pivot[&#39;Energy&#39;], linestyle=&#39;-&#39;, marker=&#39;o&#39;)</span>
        <span class="c1"># results_pivot[&#39;Energy&#39;].plot(</span>
        <span class="c1">#   kind=&#39;line&#39;, marker=&#39;d&#39;, secondary_y=True, ax=ax2)</span>
        <span class="c1"># results_pivot.loc[:,results_pivot.columns != &#39;Energy&#39;].plot.bar(</span>
        <span class="c1">#    stacked=True, color=color_array, legend=False, linewidth=3, ax=ax)</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">results_pivot</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">,</span><span class="n">stacked</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="s1">&#39;edge&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=-</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color_array</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">])</span>
        <span class="n">results_en_pivot</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">,</span><span class="n">stacked</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="s1">&#39;edge&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color_array</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">secondary_y</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">hatch</span><span class="o">=</span><span class="s1">&#39;///&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mf">.6</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">results_pivot</span><span class="o">.</span><span class="n">index</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="o">+</span><span class="mf">.6</span><span class="p">)</span>
        <span class="n">max_all</span><span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="nb">max</span><span class="p">(</span><span class="n">results_pivot</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)),</span><span class="nb">max</span><span class="p">(</span><span class="n">results_en_pivot</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">max_all</span><span class="p">)</span>
        <span class="n">h</span><span class="p">,</span><span class="n">l</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
     
        
        <span class="n">l1</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;center left&quot;</span><span class="p">,</span>
                  <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.2</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">ncol</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="kn">import</span> <span class="nn">matplotlib.patches</span> <span class="k">as</span> <span class="nn">mpatches</span>
        
        <span class="n">patch_hatched</span> <span class="o">=</span> <span class="n">mpatches</span><span class="o">.</span><span class="n">Patch</span><span class="p">(</span><span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;beige&#39;</span><span class="p">,</span> <span class="n">hatch</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;darkgrey&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Power&#39;</span><span class="p">)</span>
        <span class="n">patch_unhatched</span> <span class="o">=</span> <span class="n">mpatches</span><span class="o">.</span><span class="n">Patch</span><span class="p">(</span><span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;beige&#39;</span><span class="p">,</span> <span class="n">hatch</span><span class="o">=</span><span class="s1">&#39;///&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;darkgrey&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Energy&#39;</span><span class="p">)</span>
        
        <span class="n">l2</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="o">=</span><span class="p">[</span><span class="n">patch_hatched</span><span class="p">,</span> <span class="n">patch_unhatched</span><span class="p">],</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;center left&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.06</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>

        <span class="c1"># as soon as a second legend is made, the first disappears and needs to be added back again</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">l1</span><span class="p">)</span> 
        
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Power Capacity (MW)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">right_ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Energy Capacity (MWh)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">results_pivot</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">75</span><span class="p">)</span>
        <span class="c1">#ax2.set_ylabel(&#39;Energy Capacity (MWh)&#39;, fontsize=25)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Years&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span>  <span class="n">labelsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span><span class="c1">#</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">right_ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span>  <span class="n">labelsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
        <span class="c1">#secax = ax.secondary_yaxis(&#39;right&#39;)</span>
        <span class="c1">#secax.tick_params( labelsize=14)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span>
            <span class="s1">&#39;Installed ES capacity&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">24</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">margins</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="c1">#plt.yticks(14)</span>
        <span class="c1"># plt.close(fig)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">folder_path</span><span class="o">+</span><span class="s1">&#39;/&#39;</span> <span class="o">+</span>
                    <span class="s1">&#39;ES_inv_MWh&#39;</span><span class="o">+</span><span class="s1">&#39;.png&#39;</span><span class="p">)</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        fig, ax = plt.subplots(1, 1)</span>
<span class="sd">        for b in bus_list:</span>
<span class="sd">            results_b = results[results[&#39;b&#39;] == b]</span>
<span class="sd">            results_b_pivot = results_b[results_b[&#39;Value&#39;] &gt; 0].pivot_table(</span>
<span class="sd">                index=[&#39;y&#39;], columns=&#39;Technology&#39;, values=&#39;Value&#39;, aggfunc=&#39;sum&#39;)</span>
<span class="sd">            results_b_pivot = results_b_pivot.fillna(0)</span>
<span class="sd">            translate1 = {</span>
<span class="sd">                x: y for x, y in tech_map_info[[&#39;Tech_Num&#39;, &#39;Tech_Name&#39;]].values}</span>
<span class="sd">            cols = [translate1.get(x, x)</span>
<span class="sd">                    for x in results_b_pivot.columns]</span>
<span class="sd">            results_b_pivot.columns = cols</span>

<span class="sd">            color_array = [</span>
<span class="sd">                self.color_tech(c) for c in cols]</span>

<span class="sd">            if results_b_pivot.empty == False:</span>
<span class="sd">                results_b_pivot.plot(stacked=True, color=color_array, figsize=[</span>
<span class="sd">                    10, 8], legend=False, linewidth=3, ax=ax).figure</span>

<span class="sd">        ax.legend(loc=&quot;center left&quot;,</span>
<span class="sd">                  bbox_to_anchor=(1, 0.5), fontsize=15)</span>

<span class="sd">        ax.set_ylabel(&#39;Capacity (MW)&#39;, fontsize=25)</span>
<span class="sd">        ax.set_xlabel(&#39;Years&#39;, fontsize=25)</span>
<span class="sd">        ax.set_title(</span>
<span class="sd">            &#39;Installed ES capacity&#39;, fontsize=30)</span>
<span class="sd">        ax.margins(x=0, y=0)</span>
<span class="sd">        plt.close(fig)</span>
<span class="sd">        fig.savefig(self.policy_folder_path+&#39;/&#39; +</span>
<span class="sd">                    &#39;ES_inv_MWh&#39;+&#39;.png&#39;)</span>
<span class="sd">        &#39;&#39;&#39;</span>
    <span class="c1"># Policy results viewer</span>

<div class="viewcode-block" id="ExplanResultsViewer.policy_plot">
<a class="viewcode-back" href="../index.html#explan_results_viewer.ExplanResultsViewer.policy_plot">[docs]</a>
    <span class="k">def</span> <span class="nf">policy_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>


<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">CO2_int</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rd</span><span class="p">[</span><span class="s1">&#39;CO2_intensity&#39;</span><span class="p">]</span>
        <span class="n">CO2_em</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rd</span><span class="p">[</span><span class="s1">&#39;CO2_emission&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">CO2_em</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">names</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">results</span> <span class="o">=</span> <span class="n">CO2_em</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
        <span class="n">carbon_gen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rd</span><span class="p">[</span><span class="s1">&#39;carbon_gen&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">carbon_gen</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">names</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">results</span> <span class="o">=</span> <span class="n">carbon_gen</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
        <span class="n">ren_gen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rd</span><span class="p">[</span><span class="s1">&#39;ren_gen&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">ren_gen</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">names</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">results</span> <span class="o">=</span> <span class="n">ren_gen</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

        <span class="c1"># make plots</span>
        <span class="n">CO2_em_y</span> <span class="o">=</span> <span class="n">CO2_em</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span>
            <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">],</span> <span class="n">values</span><span class="o">=</span><span class="s1">&#39;Value&#39;</span><span class="p">,</span> <span class="n">aggfunc</span><span class="o">=</span><span class="s1">&#39;sum&#39;</span><span class="p">)</span>
        <span class="n">carbon_gen_y</span> <span class="o">=</span> <span class="n">carbon_gen</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span>
            <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">],</span> <span class="n">values</span><span class="o">=</span><span class="s1">&#39;Value&#39;</span><span class="p">,</span> <span class="n">aggfunc</span><span class="o">=</span><span class="s1">&#39;sum&#39;</span><span class="p">)</span>
        <span class="n">ren_gen_y</span> <span class="o">=</span> <span class="n">ren_gen</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span>
            <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">],</span> <span class="n">values</span><span class="o">=</span><span class="s1">&#39;Value&#39;</span><span class="p">,</span> <span class="n">aggfunc</span><span class="o">=</span><span class="s1">&#39;sum&#39;</span><span class="p">)</span>

        <span class="n">CO2_em_y</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;CO2 Emissions&#39;</span><span class="p">]</span>
        <span class="n">CO2_int</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;CO2 Intensity&#39;</span><span class="p">]</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">CO2_em_y</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">15</span><span class="p">,</span> <span class="mi">8</span><span class="p">])</span>
        <span class="n">CO2_int</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">secondary_y</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                     <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">15</span><span class="p">,</span> <span class="mi">8</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Emissions (Tons)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">25</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">right_ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span>
            <span class="s1">&#39;Intensity (Tons/MWh)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">25</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Years&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">25</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;PNM Annual Emissions&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">margins</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">policy_folder_path</span><span class="o">+</span><span class="s1">&#39;/&#39;</span> <span class="o">+</span>
                    <span class="s1">&#39;CO2_emissions&#39;</span><span class="o">+</span><span class="s1">&#39;.png&#39;</span><span class="p">)</span>

        <span class="n">gen</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">carbon_gen_y</span><span class="p">,</span> <span class="n">ren_gen_y</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">gen</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;CO2 Generation&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;Renewable Generation&#39;</span><span class="p">]</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">gen</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span>
            <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="s1">&#39;green&#39;</span><span class="p">],</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Generation (MWh)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">25</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Years&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">25</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;PNM Annual Generation&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">margins</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">policy_folder_path</span><span class="o">+</span><span class="s1">&#39;/&#39;</span> <span class="o">+</span>
                    <span class="s1">&#39;Annual_Generation&#39;</span><span class="o">+</span><span class="s1">&#39;.png&#39;</span><span class="p">)</span></div>

        <span class="c1"># pd.DataFrame(columns=[&#39;CO2 Generation&#39;, &#39;Renewable Generation&#39;],</span>
        <span class="c1">#                  index=ren_gen_y.index, data=[carbon_gen_y[&#39;Value&#39;],ren_gen_y[&#39;Value&#39;]])</span>

        <span class="c1">#ax2 = carbon_gen_y.plot.bar(color=&#39;grey&#39;)</span>
        <span class="c1">#ren_gen_y.plot.bar(ax=ax2, color=&#39;green&#39;)</span>

<div class="viewcode-block" id="ExplanResultsViewer.policy_resource_plot">
<a class="viewcode-back" href="../index.html#explan_results_viewer.ExplanResultsViewer.policy_resource_plot">[docs]</a>
    <span class="k">def</span> <span class="nf">policy_resource_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>


<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">policy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_handler</span><span class="o">.</span><span class="n">load_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">data_handler</span><span class="o">.</span><span class="n">data_ls</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;policy&#39;</span><span class="p">)]</span><span class="c1">#[&#39;RPS&#39;]</span>
        <span class="c1">#CO2 = exp.data_handler.load_data[&#39;POLICY&#39;]#[&#39;CO2&#39;]</span>
        
        <span class="n">gen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_handler</span><span class="o">.</span><span class="n">load_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">data_handler</span><span class="o">.</span><span class="n">data_ls</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;gen&#39;</span><span class="p">)]</span>
        
        <span class="n">gen_mx</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2021</span><span class="p">,</span><span class="mi">2041</span><span class="p">),</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Nuclear&#39;</span><span class="p">,</span><span class="s1">&#39;Coal&#39;</span><span class="p">,</span><span class="s1">&#39;Gas&#39;</span><span class="p">,</span><span class="s1">&#39;Geothermal&#39;</span><span class="p">])</span><span class="c1">#&#39;Solar&#39;,&#39;Wind_PPA&#39;,&#39;ES_PPA&#39;</span>
        <span class="n">gen_mx</span> <span class="o">=</span> <span class="n">gen_mx</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span>  <span class="n">gen_mx</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">gen</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
                <span class="n">gen_i</span> <span class="o">=</span> <span class="n">gen</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">g</span><span class="p">]</span>
                <span class="c1">#if gen_i[&#39;Tech&#39;]==&#39;Nuclear&#39;:</span>
                <span class="n">tech</span> <span class="o">=</span> <span class="n">gen_i</span><span class="p">[</span><span class="s1">&#39;Tech&#39;</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">tech</span> <span class="ow">in</span> <span class="n">gen_mx</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">y</span><span class="o">&lt;</span><span class="n">gen_i</span><span class="p">[</span><span class="s1">&#39;RetYr&#39;</span><span class="p">]:</span>
                        <span class="n">gen_mx</span><span class="p">[</span><span class="n">tech</span><span class="p">][</span><span class="n">y</span><span class="p">]</span> <span class="o">=</span> <span class="n">gen_mx</span><span class="p">[</span><span class="n">tech</span><span class="p">][</span><span class="n">y</span><span class="p">]</span><span class="o">+</span><span class="n">gen_i</span><span class="p">[</span><span class="s1">&#39;Cap&#39;</span><span class="p">]</span>
                    <span class="k">elif</span> <span class="n">y</span><span class="o">&gt;=</span><span class="n">gen_i</span><span class="p">[</span><span class="s1">&#39;RetYr&#39;</span><span class="p">]:</span>
                        <span class="n">gen_mx</span><span class="p">[</span><span class="n">tech</span><span class="p">][</span><span class="n">y</span><span class="p">]</span> <span class="o">=</span> <span class="n">gen_mx</span><span class="p">[</span><span class="n">tech</span><span class="p">][</span><span class="n">y</span><span class="p">]</span><span class="o">+</span><span class="n">gen_i</span><span class="p">[</span><span class="s1">&#39;Cap&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">gen_i</span><span class="p">[</span><span class="s1">&#39;RetCap&#39;</span><span class="p">]</span>
        
        <span class="c1">#make plot</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
       
        <span class="n">ax3</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">twinx</span><span class="p">()</span>
        <span class="n">rspine</span> <span class="o">=</span> <span class="n">ax3</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">]</span>
        <span class="n">rspine</span><span class="o">.</span><span class="n">set_position</span><span class="p">((</span><span class="s1">&#39;axes&#39;</span><span class="p">,</span> <span class="mf">1.15</span><span class="p">))</span>
        <span class="n">ax3</span><span class="o">.</span><span class="n">set_frame_on</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">ax3</span><span class="o">.</span><span class="n">patch</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">right</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
        
        <span class="c1">#df.A.plot(ax=ax, style=&#39;b-&#39;)</span>
        <span class="n">gen_mx</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">stacked</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">color</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;darkred&#39;</span><span class="p">,</span><span class="s1">&#39;black&#39;</span><span class="p">,</span><span class="s1">&#39;darkgrey&#39;</span><span class="p">,</span><span class="s1">&#39;rosybrown&#39;</span><span class="p">],</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">])</span>
        
        <span class="c1"># same ax as above since it&#39;s automatically added on the right</span>
        <span class="c1">#df.B.plot(ax=ax, style=&#39;r-&#39;, secondary_y=True)</span>
        <span class="c1">#df.C.plot(ax=ax3, style=&#39;g-&#39;)</span>
        <span class="n">policy</span><span class="p">[</span><span class="s1">&#39;RPS&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">secondary_y</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">legend</span> <span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
        <span class="n">policy</span><span class="p">[</span><span class="s1">&#39;CO2_intensity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax3</span><span class="p">,</span><span class="n">legend</span> <span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-.&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>            
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Capacity (MW)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span><span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Year&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span><span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">right_ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;RPS (%)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span><span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>
        <span class="n">ax3</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;CO2 Intensity (MM Ton/MWhr)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span><span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">gen_mx</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">75</span><span class="p">)</span>
        <span class="c1">#plt.tight_layout()</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">right_ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">right_ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>
        
        <span class="n">ax3</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
        <span class="n">ax3</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        
        <span class="c1">#lns = ax+ax3#lns1+lns2+lns3</span>
        <span class="c1">#labs = [l.get_label() for l in lns]</span>
        <span class="c1">#ax.legend([ax.get_label(),ax3.get_label()], labs, loc=0)</span>
        <span class="n">lines</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
        <span class="n">lines1</span><span class="p">,</span> <span class="n">labels1</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">right_ax</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
        <span class="n">labels1</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;RPS&#39;</span><span class="p">]</span>
        <span class="n">lines2</span><span class="p">,</span> <span class="n">labels2</span> <span class="o">=</span> <span class="n">ax3</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">lines</span> <span class="o">+</span> <span class="n">lines1</span><span class="o">+</span><span class="n">lines2</span><span class="p">,</span> <span class="n">labels</span><span class="o">+</span><span class="n">labels1</span> <span class="o">+</span> <span class="n">labels2</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.2</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.152</span><span class="p">),</span><span class="n">ncol</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span></div>

        
        <span class="c1"># add legend --&gt; take advantage of pandas providing us access</span>
        <span class="c1"># to the line associated with the right part of the axis</span>
        <span class="c1">#ax3.legend([ax.get_lines()[0], ax.right_ax.get_lines()[0], ax3.get_lines()[0]],\</span>
         <span class="c1">#          [&#39;A&#39;,&#39;B&#39;,&#39;C&#39;], bbox_to_anchor=(1.5, 0.5))</span>
         
<div class="viewcode-block" id="ExplanResultsViewer.energy_storage_cost">
<a class="viewcode-back" href="../index.html#explan_results_viewer.ExplanResultsViewer.energy_storage_cost">[docs]</a>
    <span class="k">def</span> <span class="nf">energy_storage_cost</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        </span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">es_pwr_en_cost</span> <span class="o">=</span> <span class="n">exp</span><span class="o">.</span><span class="n">data_handler</span><span class="o">.</span><span class="n">load_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">data_handler</span><span class="o">.</span><span class="n">data_ls</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;capex_es&#39;</span><span class="p">)]</span><span class="c1">#[&#39;RPS&#39;]</span>
        
        <span class="n">select_costs</span> <span class="o">=</span> <span class="n">es_pwr_en_cost</span><span class="p">[</span><span class="n">es_pwr_en_cost</span><span class="p">[</span><span class="s1">&#39;Tech_name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s1">&#39;Li_Ion_Cand_1&#39;</span><span class="p">,</span><span class="s1">&#39;Flow_Cand&#39;</span><span class="p">,</span><span class="s1">&#39;Therm_Cand&#39;</span><span class="p">])]</span>
        
        <span class="n">select_power_costs</span> <span class="o">=</span> <span class="n">select_costs</span><span class="p">[</span><span class="n">select_costs</span><span class="p">[</span><span class="s1">&#39;Cost&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Power&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;Tech_num&#39;</span><span class="p">,</span><span class="s1">&#39;Cost&#39;</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;Tech_name&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="n">select_energy_costs</span> <span class="o">=</span> <span class="n">select_costs</span><span class="p">[</span><span class="n">select_costs</span><span class="p">[</span><span class="s1">&#39;Cost&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Energy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;Tech_num&#39;</span><span class="p">,</span><span class="s1">&#39;Cost&#39;</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;Tech_name&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        
        <span class="n">select_power_costs</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Li-Ion (Base)&#39;</span><span class="p">,</span><span class="s1">&#39;Flow (Base)&#39;</span><span class="p">,</span><span class="s1">&#39;Thermal (Base)&#39;</span><span class="p">]</span>
        <span class="n">select_energy_costs</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Li-Ion (Base)&#39;</span><span class="p">,</span><span class="s1">&#39;Flow (Base)&#39;</span><span class="p">,</span><span class="s1">&#39;Thermal (Base)&#39;</span><span class="p">]</span>
        
        <span class="n">select_power_costs</span> <span class="o">=</span> <span class="n">select_power_costs</span><span class="p">[</span><span class="n">select_power_costs</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">years</span><span class="p">)]</span>
        <span class="n">select_energy_costs</span> <span class="o">=</span> <span class="n">select_energy_costs</span><span class="p">[</span><span class="n">select_energy_costs</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">years</span><span class="p">)]</span>
        
        <span class="n">years</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2023</span><span class="p">,</span><span class="mi">2051</span><span class="p">)</span>
        
        <span class="c1">#High</span>
        <span class="n">es_h_pwr_en_cost</span> <span class="o">=</span> <span class="n">exp</span><span class="o">.</span><span class="n">data_handler</span><span class="o">.</span><span class="n">load_data</span><span class="p">[</span><span class="s1">&#39;CAPEX_H_ES&#39;</span><span class="p">]</span><span class="c1">#[&#39;RPS&#39;]</span>
        
        <span class="n">select_costs_h</span> <span class="o">=</span> <span class="n">es_h_pwr_en_cost</span><span class="p">[</span><span class="n">es_h_pwr_en_cost</span><span class="p">[</span><span class="s1">&#39;Tech_name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s1">&#39;Li_Ion_Cand&#39;</span><span class="p">,</span><span class="s1">&#39;Flow_Cand&#39;</span><span class="p">,</span><span class="s1">&#39;Therm_Cand&#39;</span><span class="p">])]</span>
        
        <span class="n">select_power_costs_h</span> <span class="o">=</span> <span class="n">select_costs_h</span><span class="p">[</span><span class="n">select_costs_h</span><span class="p">[</span><span class="s1">&#39;Cost&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Power&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;Tech_num&#39;</span><span class="p">,</span><span class="s1">&#39;Cost&#39;</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;Tech_name&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="n">select_energy_costs_h</span> <span class="o">=</span> <span class="n">select_costs_h</span><span class="p">[</span><span class="n">select_costs_h</span><span class="p">[</span><span class="s1">&#39;Cost&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Energy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;Tech_num&#39;</span><span class="p">,</span><span class="s1">&#39;Cost&#39;</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;Tech_name&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        
        <span class="n">select_power_costs_h</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Li-Ion (High)&#39;</span><span class="p">,</span><span class="s1">&#39;Flow (High)&#39;</span><span class="p">,</span><span class="s1">&#39;Thermal (High)&#39;</span><span class="p">]</span>
        <span class="n">select_energy_costs_h</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Li-Ion (High)&#39;</span><span class="p">,</span><span class="s1">&#39;Flow (High)&#39;</span><span class="p">,</span><span class="s1">&#39;Thermal (High)&#39;</span><span class="p">]</span>
        
        <span class="n">select_power_costs_h</span> <span class="o">=</span> <span class="n">select_power_costs_h</span><span class="p">[</span><span class="n">select_power_costs_h</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">years</span><span class="p">)]</span>
        <span class="n">select_energy_costs_h</span> <span class="o">=</span> <span class="n">select_energy_costs_h</span><span class="p">[</span><span class="n">select_energy_costs_h</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">years</span><span class="p">)]</span>
        <span class="c1">#Low</span>
        <span class="n">es_l_pwr_en_cost</span> <span class="o">=</span> <span class="n">exp</span><span class="o">.</span><span class="n">data_handler</span><span class="o">.</span><span class="n">load_data</span><span class="p">[</span><span class="s1">&#39;CAPEX_L_ES&#39;</span><span class="p">]</span><span class="c1">#[&#39;RPS&#39;]</span>
        
        <span class="n">select_costs_l</span> <span class="o">=</span> <span class="n">es_l_pwr_en_cost</span><span class="p">[</span><span class="n">es_l_pwr_en_cost</span><span class="p">[</span><span class="s1">&#39;Tech_name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s1">&#39;Li_Ion_Cand&#39;</span><span class="p">,</span><span class="s1">&#39;Flow_Cand&#39;</span><span class="p">,</span><span class="s1">&#39;Therm_Cand&#39;</span><span class="p">])]</span>
        
        <span class="n">select_power_costs_l</span> <span class="o">=</span> <span class="n">select_costs_l</span><span class="p">[</span><span class="n">select_costs_l</span><span class="p">[</span><span class="s1">&#39;Cost&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Power&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;Tech_num&#39;</span><span class="p">,</span><span class="s1">&#39;Cost&#39;</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;Tech_name&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="n">select_energy_costs_l</span> <span class="o">=</span> <span class="n">select_costs_l</span><span class="p">[</span><span class="n">select_costs_l</span><span class="p">[</span><span class="s1">&#39;Cost&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Energy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;Tech_num&#39;</span><span class="p">,</span><span class="s1">&#39;Cost&#39;</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;Tech_name&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        
        <span class="n">select_power_costs_l</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Li-Ion (Low)&#39;</span><span class="p">,</span><span class="s1">&#39;Flow (Low)&#39;</span><span class="p">,</span><span class="s1">&#39;Thermal (Low)&#39;</span><span class="p">]</span>
        <span class="n">select_energy_costs_l</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Li-Ion (Low)&#39;</span><span class="p">,</span><span class="s1">&#39;Flow (Low)&#39;</span><span class="p">,</span><span class="s1">&#39;Thermal (Low)&#39;</span><span class="p">]</span>
        
        <span class="n">select_power_costs_l</span> <span class="o">=</span> <span class="n">select_power_costs_l</span><span class="p">[</span><span class="n">select_power_costs_l</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">years</span><span class="p">)]</span>
        <span class="n">select_energy_costs_l</span> <span class="o">=</span> <span class="n">select_energy_costs_l</span><span class="p">[</span><span class="n">select_energy_costs_l</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">years</span><span class="p">)]</span>
        
        
        <span class="c1">#make plot</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">])</span>
        <span class="n">select_power_costs</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">color</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;royalblue&#39;</span><span class="p">,</span><span class="s1">&#39;darkviolet&#39;</span><span class="p">,</span><span class="s1">&#39;red&#39;</span><span class="p">],</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">])</span>
        <span class="n">select_energy_costs</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">secondary_y</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span><span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">color</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;royalblue&#39;</span><span class="p">,</span><span class="s1">&#39;darkviolet&#39;</span><span class="p">,</span><span class="s1">&#39;red&#39;</span><span class="p">])</span>
        
        <span class="n">select_power_costs_h</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">color</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;royalblue&#39;</span><span class="p">,</span><span class="s1">&#39;darkviolet&#39;</span><span class="p">,</span><span class="s1">&#39;red&#39;</span><span class="p">],</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
        <span class="n">select_energy_costs_h</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">secondary_y</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span><span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">color</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;royalblue&#39;</span><span class="p">,</span><span class="s1">&#39;darkviolet&#39;</span><span class="p">,</span><span class="s1">&#39;red&#39;</span><span class="p">],</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>

        <span class="n">select_power_costs_l</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">color</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;royalblue&#39;</span><span class="p">,</span><span class="s1">&#39;darkviolet&#39;</span><span class="p">,</span><span class="s1">&#39;red&#39;</span><span class="p">],</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-.&#39;</span><span class="p">)</span>
        <span class="n">select_energy_costs_l</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">secondary_y</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span><span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">color</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;royalblue&#39;</span><span class="p">,</span><span class="s1">&#39;darkviolet&#39;</span><span class="p">,</span><span class="s1">&#39;red&#39;</span><span class="p">],</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-.&#39;</span><span class="p">)</span>
        
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">years</span><span class="p">,</span><span class="n">select_power_costs_h</span><span class="p">[</span><span class="s1">&#39;Thermal (High)&#39;</span><span class="p">],</span><span class="n">select_power_costs_l</span><span class="p">[</span><span class="s1">&#39;Thermal (Low)&#39;</span><span class="p">],</span><span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span><span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">years</span><span class="p">,</span><span class="n">select_power_costs_h</span><span class="p">[</span><span class="s1">&#39;Li-Ion (High)&#39;</span><span class="p">],</span><span class="n">select_power_costs_l</span><span class="p">[</span><span class="s1">&#39;Li-Ion (Low)&#39;</span><span class="p">],</span><span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;royalblue&#39;</span><span class="p">,</span><span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">years</span><span class="p">,</span><span class="n">select_power_costs_h</span><span class="p">[</span><span class="s1">&#39;Flow (High)&#39;</span><span class="p">],</span><span class="n">select_power_costs_l</span><span class="p">[</span><span class="s1">&#39;Flow (Low)&#39;</span><span class="p">],</span><span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;darkviolet&#39;</span><span class="p">,</span><span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">)</span>

        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">years</span><span class="p">,</span><span class="n">select_energy_costs_h</span><span class="p">[</span><span class="s1">&#39;Thermal (High)&#39;</span><span class="p">],</span><span class="n">select_energy_costs_l</span><span class="p">[</span><span class="s1">&#39;Thermal (Low)&#39;</span><span class="p">],</span><span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span><span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">years</span><span class="p">,</span><span class="n">select_energy_costs_h</span><span class="p">[</span><span class="s1">&#39;Li-Ion (High)&#39;</span><span class="p">],</span><span class="n">select_energy_costs_l</span><span class="p">[</span><span class="s1">&#39;Li-Ion (Low)&#39;</span><span class="p">],</span><span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;royalblue&#39;</span><span class="p">,</span><span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">years</span><span class="p">,</span><span class="n">select_energy_costs_h</span><span class="p">[</span><span class="s1">&#39;Flow (High)&#39;</span><span class="p">],</span><span class="n">select_energy_costs_l</span><span class="p">[</span><span class="s1">&#39;Flow (Low)&#39;</span><span class="p">],</span><span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;darkviolet&#39;</span><span class="p">,</span><span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">)</span>

        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">margins</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">margins</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Power Cost ($/kW)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span><span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Energy Cost ($/kWh)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span><span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">supxlabel</span><span class="p">(</span><span class="s1">&#39;Year&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span><span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.75</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.142</span><span class="p">),</span><span class="n">ncol</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span></div>

        <span class="c1">#ax.right_ax.set_ylabel(&#39;Energy Cost ($/kWh)&#39;, fontsize=12,fontweight=&#39;bold&#39;)#,color=&#39;green&#39;)</span>
        
<div class="viewcode-block" id="ExplanResultsViewer.stacked_resource_dispatch">
<a class="viewcode-back" href="../index.html#explan_results_viewer.ExplanResultsViewer.stacked_resource_dispatch">[docs]</a>
    <span class="k">def</span> <span class="nf">stacked_resource_dispatch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gen_map_info</span><span class="p">,</span> <span class="n">tech_map_info</span><span class="p">,</span> <span class="n">select_year</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>


<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        gen_map_info : TYPE</span>
<span class="sd">            DESCRIPTION.</span>
<span class="sd">        tech_map_info : TYPE</span>
<span class="sd">            DESCRIPTION.</span>
<span class="sd">        select_year : TYPE</span>
<span class="sd">            DESCRIPTION.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rd</span><span class="p">[</span><span class="s1">&#39;P_gen&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">names</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">results</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
        <span class="n">ES_cha</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rd</span><span class="p">[</span><span class="s1">&#39;Pcha&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">ES_cha</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">names</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">ES_cha</span> <span class="o">=</span> <span class="n">ES_cha</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
        <span class="n">ES_dis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rd</span><span class="p">[</span><span class="s1">&#39;Pdis&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">ES_dis</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">names</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">ES_dis</span> <span class="o">=</span> <span class="n">ES_dis</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
        <span class="n">Curt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rd</span><span class="p">[</span><span class="s1">&#39;Curt&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">Curt</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">names</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">Curt</span> <span class="o">=</span> <span class="n">Curt</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
        <span class="n">PF</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rd</span><span class="p">[</span><span class="s1">&#39;PF&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">PF</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">names</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">PF</span> <span class="o">=</span> <span class="n">PF</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
        <span class="n">SOC</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rd</span><span class="p">[</span><span class="s1">&#39;SOC&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">SOC</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">names</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">SOC</span> <span class="o">=</span> <span class="n">SOC</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

        <span class="c1"># Modify load dataframe</span>
        <span class="c1">#load_df_rs = load_df</span>
        <span class="n">load_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pd</span><span class="p">[</span><span class="s1">&#39;load_full&#39;</span><span class="p">]</span>
        <span class="n">ind_s</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">load_df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">names</span><span class="p">)</span>
        <span class="n">load_df_rs</span> <span class="o">=</span> <span class="n">load_df</span><span class="o">.</span><span class="n">stack</span><span class="p">()</span><span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="n">ind_s</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">load_df_rs</span> <span class="o">=</span> <span class="n">load_df_rs</span><span class="o">.</span><span class="n">droplevel</span><span class="p">(</span><span class="n">ind_s</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">load_df_rs</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">names</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">load_df_rs</span> <span class="o">=</span> <span class="n">load_df_rs</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

        <span class="c1"># investment results for screening purposes</span>
        <span class="n">g_cap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rd</span><span class="p">[</span><span class="s1">&#39;P_cap_total&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">g_cap</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">names</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">g_cap</span> <span class="o">=</span> <span class="n">g_cap</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
        <span class="n">g_cap_y</span> <span class="o">=</span> <span class="n">g_cap</span><span class="p">[</span><span class="n">g_cap</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">select_year</span><span class="p">]</span>
        <span class="n">gen_keep</span> <span class="o">=</span> <span class="n">g_cap_y</span><span class="p">[</span><span class="n">g_cap_y</span><span class="p">[</span><span class="s1">&#39;Value&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">][</span><span class="s1">&#39;g&#39;</span><span class="p">]</span>

        <span class="c1"># filter the following dataframes</span>
        <span class="n">results</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;g&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">gen_keep</span><span class="p">)]</span>
        <span class="n">ES_cha</span> <span class="o">=</span> <span class="n">ES_cha</span><span class="p">[</span><span class="n">ES_cha</span><span class="p">[</span><span class="s1">&#39;g&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">gen_keep</span><span class="p">)]</span>
        <span class="n">ES_dis</span> <span class="o">=</span> <span class="n">ES_dis</span><span class="p">[</span><span class="n">ES_dis</span><span class="p">[</span><span class="s1">&#39;g&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">gen_keep</span><span class="p">)]</span>
        <span class="n">Curt</span> <span class="o">=</span> <span class="n">Curt</span><span class="p">[</span><span class="n">Curt</span><span class="p">[</span><span class="s1">&#39;g&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">gen_keep</span><span class="p">)]</span>
        <span class="n">SOC</span> <span class="o">=</span> <span class="n">SOC</span><span class="p">[</span><span class="n">SOC</span><span class="p">[</span><span class="s1">&#39;g&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">gen_keep</span><span class="p">)]</span>

        <span class="c1"># Filter PF dataframe</span>
        <span class="n">mkt_line</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="n">PF_mkt</span> <span class="o">=</span> <span class="n">PF</span><span class="p">[</span><span class="n">PF</span><span class="p">[</span><span class="s1">&#39;l&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">mkt_line</span><span class="p">]</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        # Select datetime for specific</span>
<span class="sd">        dt_select_year = pd.DataFrame()</span>
<span class="sd">        dt_select_year[str(select_year)] = dt[str(select_year)]</span>
<span class="sd">        dt_select_year[&#39;s&#39;] = season_map_series(</span>
<span class="sd">            dt_select_year[str(select_year)])</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># add tech name</span>
        <span class="n">translate</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">x</span><span class="p">:</span> <span class="n">y</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">gen_map_info</span><span class="p">[[</span><span class="s1">&#39;Gen_num&#39;</span><span class="p">,</span> <span class="s1">&#39;Tech_Num&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span><span class="p">}</span>
        <span class="n">tech_num</span> <span class="o">=</span> <span class="p">[</span><span class="n">translate</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;g&#39;</span><span class="p">]]</span>
        <span class="n">results</span><span class="p">[</span><span class="s1">&#39;Technology&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tech_num</span>
        <span class="n">ES_cha</span><span class="p">[</span><span class="s1">&#39;Technology&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">translate</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">ES_cha</span><span class="p">[</span><span class="s1">&#39;g&#39;</span><span class="p">]]</span>
        <span class="n">ES_dis</span><span class="p">[</span><span class="s1">&#39;Technology&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">translate</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">ES_dis</span><span class="p">[</span><span class="s1">&#39;g&#39;</span><span class="p">]]</span>
        <span class="n">Curt</span><span class="p">[</span><span class="s1">&#39;Technology&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">translate</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">Curt</span><span class="p">[</span><span class="s1">&#39;g&#39;</span><span class="p">]]</span>
        <span class="c1"># SOC</span>
        <span class="n">SOC</span><span class="p">[</span><span class="s1">&#39;Technology&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">translate</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">SOC</span><span class="p">[</span><span class="s1">&#39;g&#39;</span><span class="p">]]</span>

        <span class="c1">#all_tech = np.unique(gen_map_info[&#39;Tech_ID&#39;])</span>
        <span class="c1"># need to reorder for stack plots</span>

        <span class="c1">#nums = np.arange(1,np.size(re_order_tech)+1)</span>
        <span class="c1"># num_tech =</span>

        <span class="c1"># for y in np.unique(results[&#39;y&#39;]):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_handler</span><span class="o">.</span><span class="n">block_selection</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;Full_Year&#39;</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="n">dispatch</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span>
                <span class="n">results</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">select_year</span><span class="p">)]</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">dispatch_tech</span> <span class="o">=</span> <span class="n">dispatch</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span>
                <span class="n">dispatch</span><span class="p">[</span><span class="s1">&#39;Technology&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>  <span class="c1">#</span>

            <span class="n">load_df_rs_y</span> <span class="o">=</span> <span class="n">load_df_rs</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span>
                <span class="n">load_df_rs</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">select_year</span><span class="p">)]</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">load_df_rs_y</span> <span class="o">=</span> <span class="n">load_df_rs_y</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="c1">#load_df_rs_y.column = [&#39;Load&#39;]</span>

            <span class="n">es_cha</span> <span class="o">=</span> <span class="n">ES_cha</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span>
                <span class="n">ES_cha</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">select_year</span><span class="p">)]</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">es_cha_tech</span> <span class="o">=</span> <span class="n">es_cha</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span>
                <span class="n">es_cha</span><span class="p">[</span><span class="s1">&#39;Technology&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
            <span class="c1"># season_es_cha_tech = season_es_cha_tech.drop(</span>
            <span class="c1"># [&#39;index&#39;], axis=0) &#39;level_4&#39;, &#39;level_0&#39;,</span>

            <span class="n">es_dis</span> <span class="o">=</span> <span class="n">ES_dis</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span>
                <span class="n">ES_dis</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">select_year</span><span class="p">)]</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">es_dis_tech</span> <span class="o">=</span> <span class="n">es_dis</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span>
                <span class="n">es_dis</span><span class="p">[</span><span class="s1">&#39;Technology&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
            <span class="c1"># season_es_dis_tech = season_es_dis_tech.drop(</span>
            <span class="c1"># [&#39;index&#39;], axis=0) &#39;level_4&#39;, &#39;level_0&#39;,</span>

            <span class="n">curt</span> <span class="o">=</span> <span class="n">Curt</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span>
                <span class="n">Curt</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">select_year</span><span class="p">)]</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">curt_tech</span> <span class="o">=</span> <span class="n">curt</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>

            <span class="n">soc</span> <span class="o">=</span> <span class="n">SOC</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span>
                <span class="n">SOC</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">select_year</span><span class="p">)]</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">soc_tech</span> <span class="o">=</span> <span class="n">soc</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span>
                <span class="n">soc</span><span class="p">[</span><span class="s1">&#39;Technology&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
            <span class="c1"># season_curt_tech = season_curt_tech.drop(</span>
            <span class="c1"># [&#39;index&#39;], axis=0)</span>

            <span class="c1"># rename columns</span>
            <span class="n">translate1</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">x</span><span class="p">:</span> <span class="n">y</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">tech_map_info</span><span class="p">[[</span><span class="s1">&#39;Tech_Num&#39;</span><span class="p">,</span> <span class="s1">&#39;Tech_Name&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span><span class="p">}</span>
            <span class="n">cols1</span> <span class="o">=</span> <span class="p">[</span><span class="n">translate1</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
                     <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">dispatch_tech</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
            <span class="n">dispatch_tech</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">cols1</span>
            <span class="n">cols2</span> <span class="o">=</span> <span class="p">[</span><span class="n">translate1</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;-charge&#39;</span>
                     <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">es_cha_tech</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
            <span class="n">es_cha_tech</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">cols2</span>
            <span class="n">cols3</span> <span class="o">=</span> <span class="p">[</span><span class="n">translate1</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;-discharge&#39;</span>
                     <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">es_dis_tech</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
            <span class="n">es_dis_tech</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">cols3</span>
            <span class="n">cols4</span> <span class="o">=</span> <span class="p">[</span><span class="n">translate1</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
                     <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">soc_tech</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
            <span class="n">soc_tech</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">cols4</span>

            <span class="c1"># assign colors</span>
<span class="w">            </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            color_array = [color_tech(c) for c in cols1]</span>
<span class="sd">            color_array_esc = [color_tech(c) for c in cols2]</span>
<span class="sd">            color_array_esd = [color_tech(c) for c in cols3]</span>
<span class="sd">            color_array = np.concatenate(</span>
<span class="sd">                (color_array, color_array_esc, color_array_esd), axis=None)</span>
<span class="sd">            &#39;&#39;&#39;</span>
            <span class="n">dispatch_tech</span><span class="p">[</span><span class="n">dispatch_tech</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">curt_tech</span><span class="p">[</span><span class="n">curt_tech</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="c1"># season_es_cha_tech.columns</span>
            <span class="c1">#[&#39;ES&#39;, &#39;ES 4hr (New)&#39;, &#39;ES 6hr (New)&#39;, &#39;ES 8hr (New)&#39;, &#39;ES 10hr (New)&#39;, &#39;ES 100hr (New)&#39;, &#39;Li-Ion Battery (New)&#39;, &#39;Flow Battery (New)&#39;, &#39;LDES (New)&#39;]</span>
            <span class="n">dispatch_tech</span><span class="p">[</span><span class="n">es_cha_tech</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">es_cha_tech</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span>
                <span class="n">lower</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">dispatch_tech</span><span class="p">[</span><span class="n">es_dis_tech</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span> <span class="o">=</span> <span class="n">es_dis_tech</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span>
                <span class="n">lower</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

            <span class="n">dispatch_tech</span><span class="p">[</span><span class="s1">&#39;Curtailment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span> \
                <span class="n">curt_tech</span>
            <span class="c1"># Drop all zero columns</span>
            <span class="n">dispatch_tech</span> <span class="o">=</span> <span class="n">dispatch_tech</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="p">(</span>
                <span class="n">dispatch_tech</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)]</span>
            <span class="c1"># season_dispatch_tech = season_dispatch_tech.drop(</span>
            <span class="c1">#   [&#39;ES PPA&#39;, &#39;ES 4hr (New)&#39;, &#39;ES 8hr (New)&#39;, &#39;ES Flow 10hr (New)&#39;, &#39;ES 100hr (New)&#39;], axis=1)</span>

            <span class="n">color_array</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">color_tech</span><span class="p">(</span>
                <span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">dispatch_tech</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
            <span class="c1"># season_dispatch_tech = season_dispatch_tech.drop(</span>
            <span class="c1"># [&#39;level_0&#39;], axis=0)</span>

            <span class="c1"># set date time</span>
            <span class="c1"># season_dispatch_tech.index =</span>
            <span class="c1">#x = dt_select_year[dt_select_year[&#39;s&#39;] == s][str(select_year)]</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="c1"># fig = season_dispatch_tech.plot.area(stacked=True, color=color_array, figsize=[</span>
            <span class="c1"># 16, 8], legend=False, linewidth=0).figure</span>
            <span class="n">dispatch_tech</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">area</span><span class="p">(</span><span class="n">stacked</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color_array</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span>
                <span class="mi">50</span><span class="p">,</span> <span class="mi">8</span><span class="p">],</span> <span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
            <span class="c1"># season_es_cha_tech.clip(lower=0).plot.area(stacked=True, color=color_array_esc, figsize=[</span>
            <span class="c1"># 16, 8], legend=False, linewidth=0, ax = ax)</span>
            <span class="n">load_df_rs_y</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                <span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Load&#39;</span><span class="p">)</span>
            <span class="c1"># soc_tech.plot(</span>
            <span class="c1">#  legend=False, secondary_y=True, color=&#39;b&#39;, linestyle=&#39;--&#39;, ax=ax, linewidth=3, label=&#39;State-of-Charge&#39;)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;center left&quot;</span><span class="p">,</span>
                       <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Capacity (MW)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">25</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time (hr)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">25</span><span class="p">)</span>
            <span class="c1"># ax.right_ax.set_ylim(-max(soc_tech.max(axis=1)),</span>
            <span class="c1">#                   max(soc_tech.max(axis=1)))</span>

            <span class="c1"># ax.set_xticklabels(fontsize=20)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">select_year</span><span class="p">)</span> <span class="o">+</span>
                         <span class="s1">&#39; Generation Dispatch&#39;</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">margins</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="c1"># fig.tight_layout()</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dispatch_folder_path</span><span class="o">+</span><span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">select_year</span><span class="p">)</span>
                        <span class="o">+</span> <span class="s1">&#39;.png&#39;</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
            <span class="n">fig1</span><span class="p">,</span> <span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">color_array</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">color_tech</span><span class="p">(</span>
                <span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">soc_tech</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
            <span class="n">soc_tech</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                <span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">50</span><span class="p">,</span> <span class="mi">8</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">color_array</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax1</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;State-of-Charge&#39;</span><span class="p">)</span>
            <span class="n">fig1</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;center left&quot;</span><span class="p">,</span>
                        <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;SOC (MWh)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">25</span><span class="p">)</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time (hr)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">25</span><span class="p">)</span>
            <span class="c1"># ax1.right_ax.set_ylim(-max(soc_tech.max(axis=1)),</span>
            <span class="c1">#                    max(soc_tech.max(axis=1)))</span>

            <span class="c1"># ax.set_xticklabels(fontsize=20)</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">select_year</span><span class="p">)</span> <span class="o">+</span>
                          <span class="s1">&#39; ES State-of-Charge&#39;</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">margins</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="c1"># fig.tight_layout()</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig1</span><span class="p">)</span>
            <span class="n">fig1</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dispatch_folder_path</span><span class="o">+</span><span class="s1">&#39;/SOC_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">select_year</span><span class="p">)</span>
                         <span class="o">+</span> <span class="s1">&#39;.png&#39;</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;s&#39;</span><span class="p">]):</span>
                <span class="n">season_dispatch</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span>
                    <span class="n">results</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">select_year</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;s&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">s</span><span class="p">)]</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">season_dispatch_tech</span> <span class="o">=</span> <span class="n">season_dispatch</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span>
                    <span class="n">season_dispatch</span><span class="p">[</span><span class="s1">&#39;Technology&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>  <span class="c1">#</span>

                <span class="n">load_df_rs_y</span> <span class="o">=</span> <span class="n">load_df_rs</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span>
                    <span class="n">load_df_rs</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">select_year</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">load_df_rs</span><span class="p">[</span><span class="s1">&#39;s&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">s</span><span class="p">)]</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">load_df_rs_y</span> <span class="o">=</span> <span class="n">load_df_rs_y</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="c1">#load_df_rs_y.column = [&#39;Load&#39;]</span>

                <span class="n">season_es_cha</span> <span class="o">=</span> <span class="n">ES_cha</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span>
                    <span class="n">ES_cha</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">select_year</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">ES_cha</span><span class="p">[</span><span class="s1">&#39;s&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">s</span><span class="p">)]</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">season_es_cha_tech</span> <span class="o">=</span> <span class="n">season_es_cha</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span>
                    <span class="n">season_es_cha</span><span class="p">[</span><span class="s1">&#39;Technology&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
                <span class="c1"># season_es_cha_tech = season_es_cha_tech.drop(</span>
                <span class="c1"># [&#39;index&#39;], axis=0) &#39;level_4&#39;, &#39;level_0&#39;,</span>

                <span class="n">season_es_dis</span> <span class="o">=</span> <span class="n">ES_dis</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span>
                    <span class="n">ES_dis</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">select_year</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">ES_dis</span><span class="p">[</span><span class="s1">&#39;s&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">s</span><span class="p">)]</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">season_es_dis_tech</span> <span class="o">=</span> <span class="n">season_es_dis</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span>
                    <span class="n">season_es_dis</span><span class="p">[</span><span class="s1">&#39;Technology&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
                <span class="c1"># season_es_dis_tech = season_es_dis_tech.drop(</span>
                <span class="c1"># [&#39;index&#39;], axis=0) &#39;level_4&#39;, &#39;level_0&#39;,</span>

                <span class="n">season_curt</span> <span class="o">=</span> <span class="n">Curt</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span>
                    <span class="n">Curt</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">select_year</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">Curt</span><span class="p">[</span><span class="s1">&#39;s&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">s</span><span class="p">)]</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">season_curt_tech</span> <span class="o">=</span> <span class="n">season_curt</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
                <span class="c1"># season_curt_tech = season_curt_tech.drop(</span>
                <span class="c1"># [&#39;index&#39;], axis=0)</span>

                <span class="c1"># rename columns</span>
                <span class="n">translate1</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="n">x</span><span class="p">:</span> <span class="n">y</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">tech_map_info</span><span class="p">[[</span><span class="s1">&#39;Tech_Num&#39;</span><span class="p">,</span> <span class="s1">&#39;Tech_Name&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span><span class="p">}</span>
                <span class="n">cols1</span> <span class="o">=</span> <span class="p">[</span><span class="n">translate1</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
                         <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">season_dispatch_tech</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
                <span class="n">season_dispatch_tech</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">cols1</span>
                <span class="n">cols2</span> <span class="o">=</span> <span class="p">[</span><span class="n">translate1</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;-charge&#39;</span>
                         <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">season_es_cha_tech</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
                <span class="n">season_es_cha_tech</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">cols2</span>
                <span class="n">cols3</span> <span class="o">=</span> <span class="p">[</span><span class="n">translate1</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;-discharge&#39;</span>
                         <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">season_es_dis_tech</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
                <span class="n">season_es_dis_tech</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">cols3</span>
                <span class="c1"># cols4 = [translate1.get(x, x)</span>
                <span class="c1"># for x in season_curt_tech.columns]</span>
                <span class="c1">#season_curt_tech.columns = cols4</span>

                <span class="c1"># assign colors</span>
<span class="w">                </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">                color_array = [color_tech(c) for c in cols1]</span>
<span class="sd">                color_array_esc = [color_tech(c) for c in cols2]</span>
<span class="sd">                color_array_esd = [color_tech(c) for c in cols3]</span>
<span class="sd">                color_array = np.concatenate(</span>
<span class="sd">                    (color_array, color_array_esc, color_array_esd), axis=None)</span>
<span class="sd">                &#39;&#39;&#39;</span>
                <span class="n">season_dispatch_tech</span><span class="p">[</span><span class="n">season_dispatch_tech</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">season_curt_tech</span><span class="p">[</span><span class="n">season_curt_tech</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="c1"># season_es_cha_tech.columns</span>
                <span class="c1">#[&#39;ES&#39;, &#39;ES 4hr (New)&#39;, &#39;ES 6hr (New)&#39;, &#39;ES 8hr (New)&#39;, &#39;ES 10hr (New)&#39;, &#39;ES 100hr (New)&#39;, &#39;Li-Ion Battery (New)&#39;, &#39;Flow Battery (New)&#39;, &#39;LDES (New)&#39;]</span>
                <span class="n">season_dispatch_tech</span><span class="p">[</span><span class="n">season_es_cha_tech</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">season_es_cha_tech</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span>
                    <span class="n">lower</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">season_dispatch_tech</span><span class="p">[</span><span class="n">season_es_dis_tech</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span> <span class="o">=</span> <span class="n">season_es_dis_tech</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span>
                    <span class="n">lower</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

                <span class="n">season_dispatch_tech</span><span class="p">[</span><span class="s1">&#39;Curtailment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span> \
                    <span class="n">season_curt_tech</span>
                <span class="c1"># Drop all zero columns</span>
                <span class="n">season_dispatch_tech</span> <span class="o">=</span> <span class="n">season_dispatch_tech</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="p">(</span>
                    <span class="n">season_dispatch_tech</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)]</span>
                <span class="c1"># season_dispatch_tech = season_dispatch_tech.drop(</span>
                <span class="c1">#   [&#39;ES PPA&#39;, &#39;ES 4hr (New)&#39;, &#39;ES 8hr (New)&#39;, &#39;ES Flow 10hr (New)&#39;, &#39;ES 100hr (New)&#39;], axis=1)</span>

                <span class="n">color_array</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">color_tech</span><span class="p">(</span>
                    <span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">season_dispatch_tech</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
                <span class="c1"># season_dispatch_tech = season_dispatch_tech.drop(</span>
                <span class="c1"># [&#39;level_0&#39;], axis=0)</span>

                <span class="c1"># set date time</span>
                <span class="c1"># season_dispatch_tech.index =</span>
                <span class="c1">#x = dt_select_year[dt_select_year[&#39;s&#39;] == s][str(select_year)]</span>
                <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="c1"># fig = season_dispatch_tech.plot.area(stacked=True, color=color_array, figsize=[</span>
                <span class="c1"># 16, 8], legend=False, linewidth=0).figure</span>
                <span class="n">season_dispatch_tech</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">area</span><span class="p">(</span><span class="n">stacked</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color_array</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span>
                    <span class="mi">16</span><span class="p">,</span> <span class="mi">8</span><span class="p">],</span> <span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
                <span class="c1"># season_es_cha_tech.clip(lower=0).plot.area(stacked=True, color=color_array_esc, figsize=[</span>
                <span class="c1"># 16, 8], legend=False, linewidth=0, ax = ax)</span>
                <span class="n">load_df_rs_y</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                    <span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">3.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Load&#39;</span><span class="p">)</span>
                <span class="n">fig</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;center left&quot;</span><span class="p">,</span>
                           <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.925</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">s</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">season</span> <span class="o">=</span> <span class="s1">&#39;Winter&#39;</span>
                <span class="k">elif</span> <span class="n">s</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">season</span> <span class="o">=</span> <span class="s1">&#39;Spring&#39;</span>
                <span class="k">elif</span> <span class="n">s</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="n">season</span> <span class="o">=</span> <span class="s1">&#39;Summer&#39;</span>
                <span class="k">elif</span> <span class="n">s</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                    <span class="n">season</span> <span class="o">=</span> <span class="s1">&#39;Fall&#39;</span>
                <span class="k">elif</span> <span class="n">s</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
                    <span class="n">season</span> <span class="o">=</span> <span class="s1">&#39;Peak Week&#39;</span>

                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Capacity (MW)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">25</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time (hr)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">25</span><span class="p">)</span>
                <span class="c1"># ax.set_xticklabels(fontsize=20)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">season</span><span class="o">+</span><span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">select_year</span><span class="p">)</span> <span class="o">+</span>
                             <span class="s1">&#39; Generation Dispatch&#39;</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">margins</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="c1"># fig.tight_layout()</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
                <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dispatch_folder_path</span><span class="o">+</span><span class="s1">&#39;/&#39;</span><span class="o">+</span><span class="n">season</span><span class="o">+</span><span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">select_year</span><span class="p">)</span>
                            <span class="o">+</span> <span class="s1">&#39;.png&#39;</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="ExplanResultsViewer.map_results">
<a class="viewcode-back" href="../index.html#explan_results_viewer.ExplanResultsViewer.map_results">[docs]</a>
    <span class="k">def</span> <span class="nf">map_results</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gen_map_info</span><span class="p">,</span> <span class="n">tech_map_info</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>


<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        gen_map_info : TYPE</span>
<span class="sd">            DESCRIPTION.</span>
<span class="sd">        tech_map_info : TYPE</span>
<span class="sd">            DESCRIPTION.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">gen_lat_lon_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_handler</span><span class="o">.</span><span class="n">load_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">data_handler</span><span class="o">.</span><span class="n">data_ls</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;gen_viz&#39;</span><span class="p">)]</span>

        <span class="c1"># self.rd[&#39;P_cap_total&#39;]</span>
        <span class="c1">#results = exp.var_dict[&#39;P_cap_total&#39;]</span>
        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rd</span><span class="p">[</span><span class="s1">&#39;P_cap_total&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">names</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">results</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">translate</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">x</span><span class="p">:</span> <span class="n">y</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">gen_map_info</span><span class="p">[[</span><span class="s1">&#39;Gen_num&#39;</span><span class="p">,</span> <span class="s1">&#39;Tech_Num&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span><span class="p">}</span>
        <span class="n">tech_num</span> <span class="o">=</span> <span class="p">[</span><span class="n">translate</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;g&#39;</span><span class="p">]]</span>
        <span class="n">results</span><span class="p">[</span><span class="s1">&#39;Technology&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tech_num</span>
        <span class="n">translate1</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">x</span><span class="p">:</span> <span class="n">y</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">tech_map_info</span><span class="p">[[</span><span class="s1">&#39;Tech_Num&#39;</span><span class="p">,</span> <span class="s1">&#39;Tech_Name&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span><span class="p">}</span>
        <span class="n">tech_name</span> <span class="o">=</span> <span class="p">[</span><span class="n">translate1</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
                     <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;Technology&#39;</span><span class="p">]]</span>
        <span class="n">results</span><span class="p">[</span><span class="s1">&#39;Tech_Name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tech_name</span>
        
        <span class="n">tx_expansion</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rd</span><span class="p">[</span><span class="s1">&#39;L_cap_total&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">tx_expansion</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">names</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">tx_expansion</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        
        <span class="n">line_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_handler</span><span class="o">.</span><span class="n">load_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">data_handler</span><span class="o">.</span><span class="n">data_ls</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;branch&#39;</span><span class="p">)]</span>
        <span class="n">bus_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_handler</span><span class="o">.</span><span class="n">load_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">data_handler</span><span class="o">.</span><span class="n">data_ls</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;bus&#39;</span><span class="p">)]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">system</span> <span class="o">==</span> <span class="s1">&#39;PNM&#39;</span><span class="p">:</span>
            <span class="n">rad_div</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">system</span> <span class="o">==</span> <span class="s1">&#39;RTS_GMLC_Nodal&#39;</span><span class="p">:</span>
            <span class="n">rad_div</span> <span class="o">=</span> <span class="mi">16</span>
            <span class="n">line_div</span> <span class="o">=</span> <span class="mi">100</span>

        <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">years</span><span class="p">:</span>  <span class="c1"># self.years:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">folium</span><span class="o">.</span><span class="n">Map</span><span class="p">(</span><span class="n">location</span><span class="o">=</span><span class="p">[</span><span class="mf">34.41013879673766</span><span class="p">,</span> <span class="o">-</span>
                                     <span class="mf">105.98914264797419</span><span class="p">],</span> <span class="n">zoom_start</span><span class="o">=</span><span class="mf">6.5</span><span class="p">,</span> <span class="n">zoom_control</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                           <span class="n">scrollWheelZoom</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                           <span class="n">dragging</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="c1"># Add lines to the map</span>
            <span class="n">l_fg</span> <span class="o">=</span> <span class="n">folium</span><span class="o">.</span><span class="n">FeatureGroup</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Tx&#39;</span><span class="p">,</span> <span class="n">overlay</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">l_ex</span> <span class="o">=</span> <span class="n">folium</span><span class="o">.</span><span class="n">FeatureGroup</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Tx_exp&#39;</span><span class="p">,</span> <span class="n">overlay</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            
            <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">line_data</span><span class="p">[</span><span class="s1">&#39;Line_Number&#39;</span><span class="p">]:</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">line_data</span><span class="p">[</span><span class="n">line_data</span><span class="p">[</span><span class="s1">&#39;Line_Number&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">l</span><span class="p">]</span>
                <span class="n">from_bus</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span>
                    <span class="n">line</span><span class="p">[</span><span class="s1">&#39;From_Bus_Number&#39;</span><span class="p">])</span>
                <span class="n">to_bus</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="s1">&#39;To_Bus_Number&#39;</span><span class="p">])</span>
                <span class="n">from_pt</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">((</span><span class="nb">float</span><span class="p">(</span><span class="n">bus_data</span><span class="p">[</span><span class="n">bus_data</span><span class="p">[</span><span class="s1">&#39;Bus_number&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">from_bus</span><span class="p">]</span>
                                <span class="p">[</span><span class="s1">&#39;LAT&#39;</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">bus_data</span><span class="p">[</span><span class="n">bus_data</span><span class="p">[</span><span class="s1">&#39;Bus_number&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">from_bus</span><span class="p">][</span><span class="s1">&#39;LON&#39;</span><span class="p">])))</span>
                <span class="n">to_pt</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">((</span><span class="nb">float</span><span class="p">(</span><span class="n">bus_data</span><span class="p">[</span><span class="n">bus_data</span><span class="p">[</span><span class="s1">&#39;Bus_number&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">to_bus</span><span class="p">]</span>
                              <span class="p">[</span><span class="s1">&#39;LAT&#39;</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">bus_data</span><span class="p">[</span><span class="n">bus_data</span><span class="p">[</span><span class="s1">&#39;Bus_number&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">to_bus</span><span class="p">][</span><span class="s1">&#39;LON&#39;</span><span class="p">])))</span>
                <span class="n">weight_y</span> <span class="o">=</span> <span class="n">tx_expansion</span><span class="p">[(</span><span class="n">tx_expansion</span><span class="p">[</span><span class="s1">&#39;l&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">l</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">tx_expansion</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">y</span><span class="p">)][</span><span class="s1">&#39;Value&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="c1">#weight_y_l = weight_y[weight_y[&#39;l&#39;]==line]</span>
                <span class="c1">#print(weight_y)</span>
                <span class="n">weight</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">weight_y</span><span class="p">)</span>
            
                
                <span class="n">folium</span><span class="o">.</span><span class="n">PolyLine</span><span class="p">((</span><span class="n">from_pt</span><span class="p">,</span> <span class="n">to_pt</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
                                <span class="n">weight</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">add_to</span><span class="p">(</span><span class="n">l_fg</span><span class="p">)</span>
                <span class="n">folium</span><span class="o">.</span><span class="n">PolyLine</span><span class="p">((</span><span class="n">from_pt</span><span class="p">,</span> <span class="n">to_pt</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span>
                                <span class="n">weight</span><span class="o">=</span><span class="n">weight</span><span class="o">/</span><span class="n">line_div</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">add_to</span><span class="p">(</span><span class="n">l_ex</span><span class="p">)</span>
                
            <span class="n">m</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">l_fg</span><span class="p">)</span>
            <span class="n">m</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">l_ex</span><span class="p">)</span>

            <span class="n">results_y</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">y</span><span class="p">]</span>
            <span class="n">results_y</span> <span class="o">=</span> <span class="n">results_y</span><span class="p">[</span><span class="n">results_y</span><span class="p">[</span><span class="s1">&#39;Value&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>

            <span class="k">for</span> <span class="n">tech</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">results_y</span><span class="p">[</span><span class="s1">&#39;Tech_Name&#39;</span><span class="p">]):</span>
                <span class="n">results_y_t</span> <span class="o">=</span> <span class="n">results_y</span><span class="p">[</span><span class="n">results_y</span><span class="p">[</span><span class="s1">&#39;Tech_Name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">tech</span><span class="p">]</span>
                <span class="n">color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">color_tech</span><span class="p">(</span><span class="n">tech</span><span class="p">)</span>
                <span class="n">fg</span> <span class="o">=</span> <span class="n">folium</span><span class="o">.</span><span class="n">FeatureGroup</span><span class="p">(</span>
                    <span class="n">name</span><span class="o">=</span><span class="n">tech</span><span class="p">,</span> <span class="n">overlay</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">results_y_t</span><span class="p">[</span><span class="s1">&#39;g&#39;</span><span class="p">]:</span>
                    <span class="n">gen</span> <span class="o">=</span> <span class="n">results_y_t</span><span class="p">[</span><span class="n">results_y_t</span><span class="p">[</span><span class="s1">&#39;g&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">g</span><span class="p">]</span>
                    <span class="c1">#t_name = gen[&#39;Tech_Name&#39;].values[0]</span>

                    <span class="c1"># self.color_tech(t_name)</span>
                    <span class="c1">#fg = folium.FeatureGroup(name=t_name, overlay=True)</span>
                    <span class="c1"># Change...</span>

                    <span class="n">lat</span> <span class="o">=</span> <span class="n">gen_lat_lon_df</span><span class="p">[</span><span class="n">gen_lat_lon_df</span><span class="p">[</span><span class="s1">&#39;Gen_num&#39;</span><span class="p">]</span>
                                         <span class="o">==</span> <span class="n">g</span><span class="p">][</span><span class="s1">&#39;LAT&#39;</span><span class="p">]</span>
                    <span class="n">lon</span> <span class="o">=</span> <span class="n">gen_lat_lon_df</span><span class="p">[</span><span class="n">gen_lat_lon_df</span><span class="p">[</span><span class="s1">&#39;Gen_num&#39;</span><span class="p">]</span>
                                         <span class="o">==</span> <span class="n">g</span><span class="p">][</span><span class="s1">&#39;LON&#39;</span><span class="p">]</span>
                    <span class="n">capacity</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">gen</span><span class="p">[</span><span class="s1">&#39;Value&#39;</span><span class="p">])</span>
                    <span class="n">folium</span><span class="o">.</span><span class="n">CircleMarker</span><span class="p">((</span><span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">fill_color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                        <span class="n">fill_opacity</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>  <span class="n">radius</span><span class="o">=</span><span class="n">capacity</span><span class="o">/</span><span class="n">rad_div</span><span class="p">)</span><span class="o">.</span><span class="n">add_to</span><span class="p">(</span><span class="n">fg</span><span class="p">)</span>  <span class="c1"># number_of_sides=4,</span>
                <span class="n">m</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">fg</span><span class="p">)</span>

            <span class="c1"># Create a layer control object and add it to our map instance</span>
            <span class="n">folium</span><span class="o">.</span><span class="n">LayerControl</span><span class="p">()</span><span class="o">.</span><span class="n">add_to</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
            <span class="n">map_title</span> <span class="o">=</span> <span class="s1">&#39;Generation_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;.html&#39;</span>
            <span class="n">m</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">map_folder_path</span><span class="o">+</span><span class="s2">&quot;/&quot;</span><span class="o">+</span><span class="n">map_title</span><span class="p">)</span></div>


<div class="viewcode-block" id="ExplanResultsViewer.map_es_results">
<a class="viewcode-back" href="../index.html#explan_results_viewer.ExplanResultsViewer.map_es_results">[docs]</a>
    <span class="k">def</span> <span class="nf">map_es_results</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gen_map_info</span><span class="p">,</span> <span class="n">tech_map_info</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>


<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        gen_map_info : TYPE</span>
<span class="sd">            DESCRIPTION.</span>
<span class="sd">        tech_map_info : TYPE</span>
<span class="sd">            DESCRIPTION.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">gen_lat_lon_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_handler</span><span class="o">.</span><span class="n">load_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">data_handler</span><span class="o">.</span><span class="n">data_ls</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;gen_viz&#39;</span><span class="p">)]</span>

        <span class="c1"># self.rd[&#39;P_cap_total&#39;]</span>
        <span class="c1">#results = exp.var_dict[&#39;P_cap_total&#39;]</span>
        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rd</span><span class="p">[</span><span class="s1">&#39;P_cap_total&#39;</span><span class="p">]</span>
        <span class="n">results_en</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rd</span><span class="p">[</span><span class="s1">&#39;Store&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">names</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">results</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">results_en</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">names</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">results_en</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">translate</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">x</span><span class="p">:</span> <span class="n">y</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">gen_map_info</span><span class="p">[[</span><span class="s1">&#39;Gen_num&#39;</span><span class="p">,</span> <span class="s1">&#39;Tech_Num&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span><span class="p">}</span>
        <span class="n">tech_num</span> <span class="o">=</span> <span class="p">[</span><span class="n">translate</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;g&#39;</span><span class="p">]]</span>
        <span class="n">results</span><span class="p">[</span><span class="s1">&#39;Technology&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tech_num</span>
        <span class="n">translate1</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">x</span><span class="p">:</span> <span class="n">y</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">tech_map_info</span><span class="p">[[</span><span class="s1">&#39;Tech_Num&#39;</span><span class="p">,</span> <span class="s1">&#39;Tech_Name&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span><span class="p">}</span>
        <span class="n">tech_name</span> <span class="o">=</span> <span class="p">[</span><span class="n">translate1</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
                     <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;Technology&#39;</span><span class="p">]]</span>
        <span class="n">results</span><span class="p">[</span><span class="s1">&#39;Tech_Name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tech_name</span>

        <span class="c1"># filter down into ES technologies only</span>
        <span class="n">results</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;g&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data_handler</span><span class="o">.</span><span class="n">tech_nums</span><span class="p">[</span><span class="s1">&#39;storage&#39;</span><span class="p">])]</span>

        <span class="c1"># Add energy components</span>
        <span class="n">results</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span>
            <span class="n">energy</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">results_en</span><span class="p">[</span><span class="s1">&#39;Value&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">))</span>

        <span class="n">line_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_handler</span><span class="o">.</span><span class="n">load_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">data_handler</span><span class="o">.</span><span class="n">data_ls</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;branch&#39;</span><span class="p">)]</span>
        <span class="n">bus_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_handler</span><span class="o">.</span><span class="n">load_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">data_handler</span><span class="o">.</span><span class="n">data_ls</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;bus&#39;</span><span class="p">)]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">system</span> <span class="o">==</span> <span class="s1">&#39;PNM&#39;</span><span class="p">:</span>
            <span class="n">rad_div</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">system</span> <span class="o">==</span> <span class="s1">&#39;RTS_GMLC_Nodal&#39;</span><span class="p">:</span>
            <span class="n">rad_div</span> <span class="o">=</span> <span class="mi">16</span>

        <span class="c1"># get min and max durations for bounds</span>
        <span class="c1"># min_duration = self.data_handler.load_data[&#39;STORAGE&#39;][[</span>
        <span class="c1">#   &#39;Tech_Num&#39;, &#39;Min_Duration&#39;]].pivot_table(index=&#39;Tech_Num&#39;, values=&#39;Min_Duration&#39;, aggfunc=&#39;min&#39;)</span>
        <span class="c1"># max_duration = self.data_handler.load_data[&#39;STORAGE&#39;][[</span>
        <span class="c1">#   &#39;Tech_Num&#39;, &#39;Max_Duration&#39;]].pivot_table(index=&#39;Tech_Num&#39;, values=&#39;Max_Duration&#39;, aggfunc=&#39;max&#39;)</span>
        <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_handler</span><span class="o">.</span><span class="n">years</span><span class="p">:</span>  <span class="c1"># self.years:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">folium</span><span class="o">.</span><span class="n">Map</span><span class="p">(</span><span class="n">location</span><span class="o">=</span><span class="p">[</span><span class="mf">34.41013879673766</span><span class="p">,</span> <span class="o">-</span>
                                     <span class="mf">105.98914264797419</span><span class="p">],</span> <span class="n">zoom_start</span><span class="o">=</span><span class="mf">6.5</span><span class="p">,</span> <span class="n">zoom_control</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                           <span class="n">scrollWheelZoom</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                           <span class="n">dragging</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="c1"># Add lines to the map</span>
            <span class="n">l_fg</span> <span class="o">=</span> <span class="n">folium</span><span class="o">.</span><span class="n">FeatureGroup</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Tx&#39;</span><span class="p">,</span> <span class="n">overlay</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">line_data</span><span class="p">[</span><span class="s1">&#39;Line_Number&#39;</span><span class="p">]:</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">line_data</span><span class="p">[</span><span class="n">line_data</span><span class="p">[</span><span class="s1">&#39;Line_Number&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">l</span><span class="p">]</span>
                <span class="n">from_bus</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span>
                    <span class="n">line</span><span class="p">[</span><span class="s1">&#39;From_Bus_Number&#39;</span><span class="p">])</span>
                <span class="n">to_bus</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="s1">&#39;To_Bus_Number&#39;</span><span class="p">])</span>
                <span class="n">from_pt</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">((</span><span class="nb">float</span><span class="p">(</span><span class="n">bus_data</span><span class="p">[</span><span class="n">bus_data</span><span class="p">[</span><span class="s1">&#39;Bus_number&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">from_bus</span><span class="p">]</span>
                                <span class="p">[</span><span class="s1">&#39;LAT&#39;</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">bus_data</span><span class="p">[</span><span class="n">bus_data</span><span class="p">[</span><span class="s1">&#39;Bus_number&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">from_bus</span><span class="p">][</span><span class="s1">&#39;LON&#39;</span><span class="p">])))</span>
                <span class="n">to_pt</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">((</span><span class="nb">float</span><span class="p">(</span><span class="n">bus_data</span><span class="p">[</span><span class="n">bus_data</span><span class="p">[</span><span class="s1">&#39;Bus_number&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">to_bus</span><span class="p">]</span>
                              <span class="p">[</span><span class="s1">&#39;LAT&#39;</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">bus_data</span><span class="p">[</span><span class="n">bus_data</span><span class="p">[</span><span class="s1">&#39;Bus_number&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">to_bus</span><span class="p">][</span><span class="s1">&#39;LON&#39;</span><span class="p">])))</span>
                <span class="n">folium</span><span class="o">.</span><span class="n">PolyLine</span><span class="p">((</span><span class="n">from_pt</span><span class="p">,</span> <span class="n">to_pt</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
                                <span class="n">weight</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">add_to</span><span class="p">(</span><span class="n">l_fg</span><span class="p">)</span>
            <span class="n">m</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">l_fg</span><span class="p">)</span>

            <span class="n">results_y</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">y</span><span class="p">]</span>
            <span class="n">results_y</span> <span class="o">=</span> <span class="n">results_y</span><span class="p">[</span><span class="n">results_y</span><span class="p">[</span><span class="s1">&#39;Value&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>

            <span class="n">duration</span> <span class="o">=</span> <span class="n">results_y</span><span class="p">[</span><span class="s1">&#39;energy&#39;</span><span class="p">]</span> <span class="o">/</span> \
                <span class="n">results_y</span><span class="p">[</span><span class="s1">&#39;Value&#39;</span><span class="p">]</span>
            <span class="n">min_d_t</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># int(min_duration.loc[tn])</span>
            <span class="c1"># int(max_duration.loc[tn])</span>
            <span class="n">max_d_t</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">duration</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>

            <span class="c1"># cm_opts = [&#39;YlOrBr&#39;, &#39;PRGn&#39;, &#39;RdGy&#39;,</span>
            <span class="c1">#            &#39;PuBu&#39;, &#39;PiYG&#39;, &#39;spectral&#39;]</span>
            <span class="k">for</span> <span class="n">tech</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">results_y</span><span class="p">[</span><span class="s1">&#39;Tech_Name&#39;</span><span class="p">]):</span>
                
                <span class="n">results_y_t</span> <span class="o">=</span> <span class="n">results_y</span><span class="p">[</span><span class="n">results_y</span><span class="p">[</span><span class="s1">&#39;Tech_Name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">tech</span><span class="p">]</span>
                <span class="c1"># tn = int(</span>
                <span class="c1">#     np.unique(results_y_t[&#39;Technology&#39;].values))</span>
                <span class="c1"># min_d_t = 1  # int(min_duration.loc[tn])</span>
                <span class="c1"># max_d_t = 10  # int(max_duration.loc[tn])</span>
                <span class="c1"># if min_d_t == max_d_t:</span>
                <span class="c1">#     min_d_t = 1</span>
                <span class="c1"># color = self.color_tech(tech)</span>

                <span class="n">colormap</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">LinearColormap</span><span class="p">(</span><span class="n">colors</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;darkblue&#39;</span><span class="p">,</span> <span class="s1">&#39;lightblue&#39;</span><span class="p">,</span> <span class="s1">&#39;yellow&#39;</span><span class="p">,</span> <span class="s1">&#39;red&#39;</span><span class="p">],</span>  <span class="c1"># &#39;yellow&#39;, &#39;orange&#39;, &#39;red&#39;],</span>
                                             <span class="n">vmin</span><span class="o">=</span><span class="n">min_d_t</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">max_d_t</span><span class="p">,</span>
                                             <span class="n">caption</span><span class="o">=</span><span class="n">tech</span><span class="o">+</span><span class="s1">&#39; Duration (h)&#39;</span><span class="p">)</span>  <span class="c1"># index=[0, 25, 62.5, 156.25, 390.6, 1000],</span>

                <span class="n">fg</span> <span class="o">=</span> <span class="n">folium</span><span class="o">.</span><span class="n">FeatureGroup</span><span class="p">(</span>
                    <span class="n">name</span><span class="o">=</span><span class="n">tech</span><span class="p">,</span> <span class="n">overlay</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">results_y_t</span><span class="p">[</span><span class="s1">&#39;g&#39;</span><span class="p">]:</span>
                    <span class="n">gen</span> <span class="o">=</span> <span class="n">results_y_t</span><span class="p">[</span><span class="n">results_y_t</span><span class="p">[</span><span class="s1">&#39;g&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">g</span><span class="p">]</span>
                    <span class="c1">#t_name = gen[&#39;Tech_Name&#39;].values[0]</span>

                    <span class="c1"># self.color_tech(t_name)</span>
                    <span class="c1">#fg = folium.FeatureGroup(name=t_name, overlay=True)</span>
                    <span class="c1"># Change...</span>

                    <span class="n">lat</span> <span class="o">=</span> <span class="n">gen_lat_lon_df</span><span class="p">[</span><span class="n">gen_lat_lon_df</span><span class="p">[</span><span class="s1">&#39;Gen_num&#39;</span><span class="p">]</span>
                                         <span class="o">==</span> <span class="n">g</span><span class="p">][</span><span class="s1">&#39;LAT&#39;</span><span class="p">]</span>
                    <span class="n">lon</span> <span class="o">=</span> <span class="n">gen_lat_lon_df</span><span class="p">[</span><span class="n">gen_lat_lon_df</span><span class="p">[</span><span class="s1">&#39;Gen_num&#39;</span><span class="p">]</span>
                                         <span class="o">==</span> <span class="n">g</span><span class="p">][</span><span class="s1">&#39;LON&#39;</span><span class="p">]</span>
                    <span class="n">power</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">gen</span><span class="p">[</span><span class="s1">&#39;Value&#39;</span><span class="p">])</span>
                    <span class="n">energy</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">gen</span><span class="p">[</span><span class="s1">&#39;energy&#39;</span><span class="p">])</span>
                    <span class="n">duration_g</span> <span class="o">=</span> <span class="n">energy</span><span class="o">/</span><span class="n">power</span>

                    <span class="n">color</span> <span class="o">=</span> <span class="n">colormap</span><span class="p">(</span><span class="n">duration_g</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">tech</span> <span class="o">==</span> <span class="s1">&#39;Therm (New)&#39;</span><span class="p">:</span><span class="c1">#g in [132,133,134,135,136,137]:</span>
                        <span class="n">folium</span><span class="o">.</span><span class="n">RegularPolygonMarker</span><span class="p">((</span><span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">fill_color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                        <span class="n">fill_opacity</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>  <span class="n">radius</span><span class="o">=</span><span class="n">power</span><span class="o">/</span><span class="n">rad_div</span><span class="p">,</span><span class="n">number_of_sides</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">add_to</span><span class="p">(</span><span class="n">fg</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">folium</span><span class="o">.</span><span class="n">CircleMarker</span><span class="p">((</span><span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">fill_color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                        <span class="n">fill_opacity</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>  <span class="n">radius</span><span class="o">=</span><span class="n">power</span><span class="o">/</span><span class="n">rad_div</span><span class="p">)</span><span class="o">.</span><span class="n">add_to</span><span class="p">(</span><span class="n">fg</span><span class="p">)</span>  <span class="c1"># number_of_sides=4,</span>
                <span class="n">m</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">fg</span><span class="p">)</span>
                <span class="n">m</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">colormap</span><span class="p">)</span>
                <span class="c1"># colormap.add_to(m)</span>

            <span class="c1"># Create a layer control object and add it to our map instance</span>
            <span class="n">folium</span><span class="o">.</span><span class="n">LayerControl</span><span class="p">()</span><span class="o">.</span><span class="n">add_to</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
            <span class="n">map_title</span> <span class="o">=</span> <span class="s1">&#39;ES_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;.html&#39;</span>
            <span class="n">m</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">map_folder_path</span> <span class="o">+</span>
                   <span class="s2">&quot;/&quot;</span><span class="o">+</span><span class="n">map_title</span><span class="p">)</span></div>


<div class="viewcode-block" id="ExplanResultsViewer.map_ren_cf">
<a class="viewcode-back" href="../index.html#explan_results_viewer.ExplanResultsViewer.map_ren_cf">[docs]</a>
    <span class="k">def</span> <span class="nf">map_ren_cf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gen_map_info</span><span class="p">,</span> <span class="n">tech_map_info</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>


<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        gen_map_info : TYPE</span>
<span class="sd">            DESCRIPTION.</span>
<span class="sd">        tech_map_info : TYPE</span>
<span class="sd">            DESCRIPTION.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">gen_lat_lon_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_handler</span><span class="o">.</span><span class="n">load_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">data_handler</span><span class="o">.</span><span class="n">data_ls</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;gen_viz&#39;</span><span class="p">)]</span>

        <span class="c1"># self.rd[&#39;P_cap_total&#39;]</span>
        <span class="c1">#results = exp.var_dict[&#39;P_cap_total&#39;]</span>
        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rd</span><span class="p">[</span><span class="s1">&#39;P_cap_total&#39;</span><span class="p">]</span>
        <span class="n">results_en</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rd</span><span class="p">[</span><span class="s1">&#39;Store&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">names</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">results</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">results_en</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">names</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">results_en</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">translate</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">x</span><span class="p">:</span> <span class="n">y</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">gen_map_info</span><span class="p">[[</span><span class="s1">&#39;Gen_num&#39;</span><span class="p">,</span> <span class="s1">&#39;Tech_Num&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span><span class="p">}</span>
        <span class="n">tech_num</span> <span class="o">=</span> <span class="p">[</span><span class="n">translate</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;g&#39;</span><span class="p">]]</span>
        <span class="n">results</span><span class="p">[</span><span class="s1">&#39;Technology&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tech_num</span>
        <span class="n">translate1</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">x</span><span class="p">:</span> <span class="n">y</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">tech_map_info</span><span class="p">[[</span><span class="s1">&#39;Tech_Num&#39;</span><span class="p">,</span> <span class="s1">&#39;Tech_Name&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span><span class="p">}</span>
        <span class="n">tech_name</span> <span class="o">=</span> <span class="p">[</span><span class="n">translate1</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
                     <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;Technology&#39;</span><span class="p">]]</span>
        <span class="n">results</span><span class="p">[</span><span class="s1">&#39;Tech_Name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tech_name</span>

        <span class="c1"># filter down into ES technologies only</span>
        <span class="n">results</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;g&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data_handler</span><span class="o">.</span><span class="n">tech_nums</span><span class="p">[</span><span class="s1">&#39;storage&#39;</span><span class="p">])]</span>

        <span class="c1"># Add energy components</span>
        <span class="n">results</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span>
            <span class="n">energy</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">results_en</span><span class="p">[</span><span class="s1">&#39;Value&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">))</span>

        <span class="n">line_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_handler</span><span class="o">.</span><span class="n">load_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">data_handler</span><span class="o">.</span><span class="n">data_ls</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;branch&#39;</span><span class="p">)]</span>
        <span class="n">bus_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_handler</span><span class="o">.</span><span class="n">load_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">data_handler</span><span class="o">.</span><span class="n">data_ls</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;bus&#39;</span><span class="p">)]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">system</span> <span class="o">==</span> <span class="s1">&#39;PNM&#39;</span><span class="p">:</span>
            <span class="n">rad_div</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">system</span> <span class="o">==</span> <span class="s1">&#39;RTS_GMLC_Nodal&#39;</span><span class="p">:</span>
            <span class="n">rad_div</span> <span class="o">=</span> <span class="mi">16</span>

        <span class="c1"># get min and max durations for bounds</span>
        <span class="c1"># min_duration = self.data_handler.load_data[&#39;STORAGE&#39;][[</span>
        <span class="c1">#   &#39;Tech_Num&#39;, &#39;Min_Duration&#39;]].pivot_table(index=&#39;Tech_Num&#39;, values=&#39;Min_Duration&#39;, aggfunc=&#39;min&#39;)</span>
        <span class="c1"># max_duration = self.data_handler.load_data[&#39;STORAGE&#39;][[</span>
        <span class="c1">#   &#39;Tech_Num&#39;, &#39;Max_Duration&#39;]].pivot_table(index=&#39;Tech_Num&#39;, values=&#39;Max_Duration&#39;, aggfunc=&#39;max&#39;)</span>
        <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_handler</span><span class="o">.</span><span class="n">years</span><span class="p">:</span>  <span class="c1"># self.years:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">folium</span><span class="o">.</span><span class="n">Map</span><span class="p">(</span><span class="n">location</span><span class="o">=</span><span class="p">[</span><span class="mf">34.41013879673766</span><span class="p">,</span> <span class="o">-</span>
                                     <span class="mf">105.98914264797419</span><span class="p">],</span> <span class="n">zoom_start</span><span class="o">=</span><span class="mf">6.5</span><span class="p">,</span> <span class="n">zoom_control</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                           <span class="n">scrollWheelZoom</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                           <span class="n">dragging</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="c1"># Add lines to the map</span>
            <span class="n">l_fg</span> <span class="o">=</span> <span class="n">folium</span><span class="o">.</span><span class="n">FeatureGroup</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Tx&#39;</span><span class="p">,</span> <span class="n">overlay</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">line_data</span><span class="p">[</span><span class="s1">&#39;Line_Number&#39;</span><span class="p">]:</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">line_data</span><span class="p">[</span><span class="n">line_data</span><span class="p">[</span><span class="s1">&#39;Line_Number&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">l</span><span class="p">]</span>
                <span class="n">from_bus</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span>
                    <span class="n">line</span><span class="p">[</span><span class="s1">&#39;From_Bus_Number&#39;</span><span class="p">])</span>
                <span class="n">to_bus</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="s1">&#39;To_Bus_Number&#39;</span><span class="p">])</span>
                <span class="n">from_pt</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">((</span><span class="nb">float</span><span class="p">(</span><span class="n">bus_data</span><span class="p">[</span><span class="n">bus_data</span><span class="p">[</span><span class="s1">&#39;Bus_number&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">from_bus</span><span class="p">]</span>
                                <span class="p">[</span><span class="s1">&#39;LAT&#39;</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">bus_data</span><span class="p">[</span><span class="n">bus_data</span><span class="p">[</span><span class="s1">&#39;Bus_number&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">from_bus</span><span class="p">][</span><span class="s1">&#39;LON&#39;</span><span class="p">])))</span>
                <span class="n">to_pt</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">((</span><span class="nb">float</span><span class="p">(</span><span class="n">bus_data</span><span class="p">[</span><span class="n">bus_data</span><span class="p">[</span><span class="s1">&#39;Bus_number&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">to_bus</span><span class="p">]</span>
                              <span class="p">[</span><span class="s1">&#39;LAT&#39;</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">bus_data</span><span class="p">[</span><span class="n">bus_data</span><span class="p">[</span><span class="s1">&#39;Bus_number&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">to_bus</span><span class="p">][</span><span class="s1">&#39;LON&#39;</span><span class="p">])))</span>
                <span class="n">folium</span><span class="o">.</span><span class="n">PolyLine</span><span class="p">((</span><span class="n">from_pt</span><span class="p">,</span> <span class="n">to_pt</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
                                <span class="n">weight</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">add_to</span><span class="p">(</span><span class="n">l_fg</span><span class="p">)</span>
            <span class="n">m</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">l_fg</span><span class="p">)</span>

            <span class="n">results_y</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">y</span><span class="p">]</span>
            <span class="n">results_y</span> <span class="o">=</span> <span class="n">results_y</span><span class="p">[</span><span class="n">results_y</span><span class="p">[</span><span class="s1">&#39;Value&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>

            <span class="n">cm_opts</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;YlOrBr&#39;</span><span class="p">,</span> <span class="s1">&#39;PRGn&#39;</span><span class="p">,</span> <span class="s1">&#39;RdGy&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;PuBu&#39;</span><span class="p">,</span> <span class="s1">&#39;PiYG&#39;</span><span class="p">,</span> <span class="s1">&#39;spectral&#39;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">tech</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">results_y</span><span class="p">[</span><span class="s1">&#39;Tech_Name&#39;</span><span class="p">]):</span>
                <span class="n">results_y_t</span> <span class="o">=</span> <span class="n">results_y</span><span class="p">[</span><span class="n">results_y</span><span class="p">[</span><span class="s1">&#39;Tech_Name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">tech</span><span class="p">]</span>
                <span class="n">tn</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">results_y_t</span><span class="p">[</span><span class="s1">&#39;Technology&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">))</span>
                <span class="n">min_d_t</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># int(min_duration.loc[tn])</span>
                <span class="n">max_d_t</span> <span class="o">=</span> <span class="mi">10</span>  <span class="c1"># int(max_duration.loc[tn])</span>
                <span class="k">if</span> <span class="n">min_d_t</span> <span class="o">==</span> <span class="n">max_d_t</span><span class="p">:</span>
                    <span class="n">min_d_t</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="n">color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">color_tech</span><span class="p">(</span><span class="n">tech</span><span class="p">)</span>
                <span class="n">colormap</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">LinearColormap</span><span class="p">(</span><span class="n">colors</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;darkblue&#39;</span><span class="p">,</span> <span class="s1">&#39;lightblue&#39;</span><span class="p">,</span> <span class="s1">&#39;yellow&#39;</span><span class="p">,</span> <span class="s1">&#39;red&#39;</span><span class="p">],</span>  <span class="c1"># &#39;yellow&#39;, &#39;orange&#39;, &#39;red&#39;],</span>
                                             <span class="n">vmin</span><span class="o">=</span><span class="n">min_d_t</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">max_d_t</span><span class="p">,</span>
                                             <span class="n">caption</span><span class="o">=</span><span class="n">tech</span><span class="o">+</span><span class="s1">&#39; Duration (h)&#39;</span><span class="p">)</span>  <span class="c1"># index=[0, 25, 62.5, 156.25, 390.6, 1000],</span>

                <span class="n">fg</span> <span class="o">=</span> <span class="n">folium</span><span class="o">.</span><span class="n">FeatureGroup</span><span class="p">(</span>
                    <span class="n">name</span><span class="o">=</span><span class="n">tech</span><span class="p">,</span> <span class="n">overlay</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">results_y_t</span><span class="p">[</span><span class="s1">&#39;g&#39;</span><span class="p">]:</span>
                    <span class="n">gen</span> <span class="o">=</span> <span class="n">results_y_t</span><span class="p">[</span><span class="n">results_y_t</span><span class="p">[</span><span class="s1">&#39;g&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">g</span><span class="p">]</span>
                    <span class="c1">#t_name = gen[&#39;Tech_Name&#39;].values[0]</span>

                    <span class="c1"># self.color_tech(t_name)</span>
                    <span class="c1">#fg = folium.FeatureGroup(name=t_name, overlay=True)</span>
                    <span class="c1"># Change...</span>

                    <span class="n">lat</span> <span class="o">=</span> <span class="n">gen_lat_lon_df</span><span class="p">[</span><span class="n">gen_lat_lon_df</span><span class="p">[</span><span class="s1">&#39;Gen_num&#39;</span><span class="p">]</span>
                                         <span class="o">==</span> <span class="n">g</span><span class="p">][</span><span class="s1">&#39;LAT&#39;</span><span class="p">]</span>
                    <span class="n">lon</span> <span class="o">=</span> <span class="n">gen_lat_lon_df</span><span class="p">[</span><span class="n">gen_lat_lon_df</span><span class="p">[</span><span class="s1">&#39;Gen_num&#39;</span><span class="p">]</span>
                                         <span class="o">==</span> <span class="n">g</span><span class="p">][</span><span class="s1">&#39;LON&#39;</span><span class="p">]</span>
                    <span class="n">capacity</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">gen</span><span class="p">[</span><span class="s1">&#39;Value&#39;</span><span class="p">])</span>
                    <span class="n">color</span> <span class="o">=</span> <span class="n">colormap</span><span class="p">(</span>
                        <span class="nb">float</span><span class="p">(</span><span class="n">gen</span><span class="p">[</span><span class="s1">&#39;energy&#39;</span><span class="p">])</span><span class="o">/</span><span class="n">capacity</span><span class="p">)</span>
                    <span class="n">folium</span><span class="o">.</span><span class="n">CircleMarker</span><span class="p">((</span><span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">fill_color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                        <span class="n">fill_opacity</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>  <span class="n">radius</span><span class="o">=</span><span class="n">capacity</span><span class="o">/</span><span class="n">rad_div</span><span class="p">)</span><span class="o">.</span><span class="n">add_to</span><span class="p">(</span><span class="n">fg</span><span class="p">)</span>  <span class="c1"># number_of_sides=4,</span>
                <span class="n">m</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">fg</span><span class="p">)</span>
                <span class="n">m</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">colormap</span><span class="p">)</span>
                <span class="c1"># colormap.add_to(m)</span>

            <span class="c1"># Create a layer control object and add it to our map instance</span>
            <span class="n">folium</span><span class="o">.</span><span class="n">LayerControl</span><span class="p">()</span><span class="o">.</span><span class="n">add_to</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
            <span class="n">map_title</span> <span class="o">=</span> <span class="s1">&#39;ES_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;.html&#39;</span>
            <span class="n">m</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">map_folder_path</span> <span class="o">+</span>
                   <span class="s2">&quot;/&quot;</span><span class="o">+</span><span class="n">map_title</span><span class="p">)</span></div>
</div>


</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">QuESt Planning</a></h1>








<h3>Navigation</h3>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2024, Cody Newlun.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 7.3.7</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 0.7.16</a>
      
    </div>

    

    
  </body>
</html>